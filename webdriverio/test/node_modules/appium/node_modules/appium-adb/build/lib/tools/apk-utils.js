"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.REMOTE_CACHE_ROOT = void 0;

require("source-map-support/register");

var _helpers = require("../helpers.js");

var _teen_process = require("teen_process");

var _logger = _interopRequireDefault(require("../logger.js"));

var _path = _interopRequireDefault(require("path"));

var _lodash = _interopRequireDefault(require("lodash"));

var _asyncbox = require("asyncbox");

var _appiumSupport = require("appium-support");

var _semver = _interopRequireDefault(require("semver"));

var _os = _interopRequireDefault(require("os"));

var _lruCache = _interopRequireDefault(require("lru-cache"));

let apkUtilsMethods = {};
const ACTIVITIES_TROUBLESHOOTING_LINK = 'https://github.com/appium/appium/blob/master/docs/en/writing-running-appium/android/activity-startup.md';
apkUtilsMethods.APP_INSTALL_STATE = {
  UNKNOWN: 'unknown',
  NOT_INSTALLED: 'notInstalled',
  NEWER_VERSION_INSTALLED: 'newerVersionInstalled',
  SAME_VERSION_INSTALLED: 'sameVersionInstalled',
  OLDER_VERSION_INSTALLED: 'olderVersionInstalled'
};
const REMOTE_CACHE_ROOT = '/data/local/tmp/appium_cache';
exports.REMOTE_CACHE_ROOT = REMOTE_CACHE_ROOT;

apkUtilsMethods.isAppInstalled = async function isAppInstalled(pkg) {
  _logger.default.debug(`Getting install status for ${pkg}`);

  const installedPattern = new RegExp(`^\\s*Package\\s+\\[${_lodash.default.escapeRegExp(pkg)}\\][^:]+:$`, 'm');

  try {
    const stdout = await this.shell(['dumpsys', 'package', pkg]);
    const isInstalled = installedPattern.test(stdout);

    _logger.default.debug(`'${pkg}' is${!isInstalled ? ' not' : ''} installed`);

    return isInstalled;
  } catch (e) {
    throw new Error(`Error finding if '${pkg}' is installed. Original error: ${e.message}`);
  }
};

apkUtilsMethods.startUri = async function startUri(uri, pkg) {
  if (!uri || !pkg) {
    throw new Error('URI and package arguments are required');
  }

  const args = ['am', 'start', '-W', '-a', 'android.intent.action.VIEW', '-d', uri.replace(/&/g, '\\&'), pkg];

  try {
    const res = await this.shell(args);

    if (res.toLowerCase().includes('unable to resolve intent')) {
      throw new Error(res);
    }
  } catch (e) {
    throw new Error(`Error attempting to start URI. Original error: ${e}`);
  }
};

apkUtilsMethods.startApp = async function startApp(startAppOptions = {}) {
  if (!startAppOptions.activity || !startAppOptions.pkg) {
    throw new Error('activity and pkg are required to start an application');
  }

  startAppOptions = _lodash.default.clone(startAppOptions);
  startAppOptions.activity = startAppOptions.activity.replace('$', '\\$');

  _lodash.default.defaults(startAppOptions, {
    waitPkg: startAppOptions.pkg,
    waitForLaunch: true,
    waitActivity: false,
    retry: true,
    stopApp: true
  });

  startAppOptions.waitPkg = startAppOptions.waitPkg || startAppOptions.pkg;
  const apiLevel = await this.getApiLevel();
  const cmd = (0, _helpers.buildStartCmd)(startAppOptions, apiLevel);

  try {
    const shellOpts = {};

    if (_lodash.default.isInteger(startAppOptions.waitDuration) && startAppOptions.waitDuration > 20000) {
      shellOpts.timeout = startAppOptions.waitDuration;
    }

    const stdout = await this.shell(cmd, shellOpts);

    if (stdout.includes('Error: Activity class') && stdout.includes('does not exist')) {
      if (startAppOptions.retry && !startAppOptions.activity.startsWith('.')) {
        _logger.default.debug(`We tried to start an activity that doesn't exist, ` + `retrying with '.${startAppOptions.activity}' activity name`);

        startAppOptions.activity = `.${startAppOptions.activity}`;
        startAppOptions.retry = false;
        return await this.startApp(startAppOptions);
      }

      throw new Error(`Activity name '${startAppOptions.activity}' used to start the app doesn't ` + `exist or cannot be launched! Make sure it exists and is a launchable activity`);
    } else if (stdout.includes('java.lang.SecurityException')) {
      throw new Error(`The permission to start '${startAppOptions.activity}' activity has been denied.` + `Make sure the activity/package names are correct.`);
    }

    if (startAppOptions.waitActivity) {
      await this.waitForActivity(startAppOptions.waitPkg, startAppOptions.waitActivity, startAppOptions.waitDuration);
    }

    return stdout;
  } catch (e) {
    throw new Error(`Cannot start the '${startAppOptions.pkg}' application. ` + `Visit ${ACTIVITIES_TROUBLESHOOTING_LINK} for troubleshooting. ` + `Original error: ${e.message}`);
  }
};

apkUtilsMethods.dumpWindows = async function dumpWindows() {
  const apiLevel = await this.getApiLevel();
  const dumpsysArg = apiLevel >= 29 ? 'displays' : 'windows';
  const cmd = ['dumpsys', 'window', dumpsysArg];
  return await this.shell(cmd);
};

apkUtilsMethods.getFocusedPackageAndActivity = async function getFocusedPackageAndActivity() {
  _logger.default.debug('Getting focused package and activity');

  const nullFocusedAppRe = new RegExp(/^\s*mFocusedApp=null/, 'm');
  const focusedAppRe = new RegExp('^\\s*mFocusedApp.+Record\\{.*\\s([^\\s\\/\\}]+)' + '\\/([^\\s\\/\\}\\,]+)\\,?(\\s[^\\s\\/\\}]+)*\\}', 'm');
  const nullCurrentFocusRe = new RegExp(/^\s*mCurrentFocus=null/, 'm');
  const currentFocusAppRe = new RegExp('^\\s*mCurrentFocus.+\\{.+\\s([^\\s\\/]+)\\/([^\\s]+)\\b', 'm');

  try {
    const stdout = await this.dumpWindows();

    for (const pattern of [focusedAppRe, currentFocusAppRe]) {
      const match = pattern.exec(stdout);

      if (match) {
        return {
          appPackage: match[1].trim(),
          appActivity: match[2].trim()
        };
      }
    }

    for (const pattern of [nullFocusedAppRe, nullCurrentFocusRe]) {
      if (pattern.exec(stdout)) {
        return {
          appPackage: null,
          appActivity: null
        };
      }
    }

    throw new Error('Could not parse activity from dumpsys');
  } catch (e) {
    throw new Error(`Could not get focusPackageAndActivity. Original error: ${e.message}`);
  }
};

apkUtilsMethods.waitForActivityOrNot = async function waitForActivityOrNot(pkg, activity, waitForStop, waitMs = 20000) {
  if (!pkg || !activity) {
    throw new Error('Package and activity required.');
  }

  _logger.default.debug(`Waiting up to ${waitMs}ms for activity matching pkg: '${pkg}' and ` + `activity: '${activity}' to${waitForStop ? ' not' : ''} be focused`);

  const splitNames = names => names.split(',').map(name => name.trim());

  const allPackages = splitNames(pkg);
  const allActivities = splitNames(activity);
  let possibleActivityNames = [];

  for (let oneActivity of allActivities) {
    if (oneActivity.startsWith('.')) {
      for (let currentPkg of allPackages) {
        possibleActivityNames.push(`${currentPkg}${oneActivity}`.replace(/\.+/g, '.'));
      }
    } else {
      possibleActivityNames.push(oneActivity);
      possibleActivityNames.push(`${pkg}.${oneActivity}`);
    }
  }

  _logger.default.debug(`Possible activities, to be checked: ${possibleActivityNames.map(name => `'${name}'`).join(', ')}`);

  let possibleActivityPatterns = possibleActivityNames.map(possibleActivityName => new RegExp(`^${possibleActivityName.replace(/\./g, '\\.').replace(/\*/g, '.*?').replace(/\$/g, '\\$')}$`));
  let retries = parseInt(waitMs / 750, 10) || 1;
  retries = isNaN(retries) ? 30 : retries;
  await (0, _asyncbox.retryInterval)(retries, 750, async () => {
    let {
      appPackage,
      appActivity
    } = await this.getFocusedPackageAndActivity();

    if (appActivity && appPackage) {
      let fullyQualifiedActivity = appActivity.startsWith('.') ? `${appPackage}${appActivity}` : appActivity;

      _logger.default.debug(`Found package: '${appPackage}' and fully qualified activity name : '${fullyQualifiedActivity}'`);

      let foundAct = _lodash.default.includes(allPackages, appPackage) && _lodash.default.findIndex(possibleActivityPatterns, possiblePattern => possiblePattern.test(fullyQualifiedActivity)) !== -1;

      if (!waitForStop && foundAct || waitForStop && !foundAct) {
        return;
      }
    }

    _logger.default.debug('Incorrect package and activity. Retrying.');

    throw new Error(`${possibleActivityNames.map(name => `'${name}'`).join(' or ')} never ${waitForStop ? 'stopped' : 'started'}. ` + `Visit ${ACTIVITIES_TROUBLESHOOTING_LINK} for troubleshooting`);
  });
};

apkUtilsMethods.waitForActivity = async function waitForActivity(pkg, act, waitMs = 20000) {
  await this.waitForActivityOrNot(pkg, act, false, waitMs);
};

apkUtilsMethods.waitForNotActivity = async function waitForNotActivity(pkg, act, waitMs = 20000) {
  await this.waitForActivityOrNot(pkg, act, true, waitMs);
};

apkUtilsMethods.uninstallApk = async function uninstallApk(pkg, options = {}) {
  _logger.default.debug(`Uninstalling ${pkg}`);

  if (!(await this.isAppInstalled(pkg))) {
    _logger.default.info(`${pkg} was not uninstalled, because it was not present on the device`);

    return false;
  }

  const cmd = ['uninstall'];

  if (options.keepData) {
    cmd.push('-k');
  }

  cmd.push(pkg);
  let stdout;

  try {
    await this.forceStop(pkg);
    stdout = (await this.adbExec(cmd, {
      timeout: options.timeout
    })).trim();
  } catch (e) {
    throw new Error(`Unable to uninstall APK. Original error: ${e.message}`);
  }

  _logger.default.debug(`'adb ${cmd.join(' ')}' command output: ${stdout}`);

  if (stdout.includes('Success')) {
    _logger.default.info(`${pkg} was successfully uninstalled`);

    return true;
  }

  _logger.default.info(`${pkg} was not uninstalled`);

  return false;
};

apkUtilsMethods.installFromDevicePath = async function installFromDevicePath(apkPathOnDevice, opts = {}) {
  let stdout = await this.shell(['pm', 'install', '-r', apkPathOnDevice], opts);

  if (stdout.indexOf('Failure') !== -1) {
    throw new Error(`Remote install failed: ${stdout}`);
  }
};

apkUtilsMethods.cacheApk = async function cacheApk(apkPath, options = {}) {
  const appHash = await _appiumSupport.fs.hash(apkPath);

  const remotePath = _path.default.posix.join(REMOTE_CACHE_ROOT, `${appHash}.apk`);

  const remoteCachedFiles = [];

  try {
    const errorMarker = '_ERROR_';
    let lsOutput = null;

    if (this._areExtendedLsOptionsSupported === true || !_lodash.default.isBoolean(this._areExtendedLsOptionsSupported)) {
      lsOutput = await this.shell([`ls -t -1 ${REMOTE_CACHE_ROOT} 2>&1 || echo ${errorMarker}`]);
    }

    if (!_lodash.default.isString(lsOutput) || lsOutput.includes(errorMarker) && !lsOutput.includes(REMOTE_CACHE_ROOT)) {
      if (!_lodash.default.isBoolean(this._areExtendedLsOptionsSupported)) {
        _logger.default.debug('The current Android API does not support extended ls options. ' + 'Defaulting to no-options call');
      }

      lsOutput = await this.shell([`ls ${REMOTE_CACHE_ROOT} 2>&1 || echo ${errorMarker}`]);
      this._areExtendedLsOptionsSupported = false;
    } else {
      this._areExtendedLsOptionsSupported = true;
    }

    if (lsOutput.includes(errorMarker)) {
      throw new Error(lsOutput.substring(0, lsOutput.indexOf(errorMarker)));
    }

    remoteCachedFiles.push(...lsOutput.split('\n').map(x => x.trim()).filter(Boolean));
  } catch (e) {
    _logger.default.debug(`Got an error '${e.message.trim()}' while getting the list of files in the cache. ` + `Assuming the cache does not exist yet`);

    await this.shell(['mkdir', '-p', REMOTE_CACHE_ROOT]);
  }

  _logger.default.debug(`The count of applications in the cache: ${remoteCachedFiles.length}`);

  const toHash = remotePath => _path.default.posix.parse(remotePath).name;

  if (remoteCachedFiles.find(x => toHash(x) === appHash)) {
    _logger.default.info(`The application at '${apkPath}' is already cached to '${remotePath}'`);
  } else {
    _logger.default.info(`Caching the application at '${apkPath}' to '${remotePath}'`);

    const started = process.hrtime();
    await this.push(apkPath, remotePath, {
      timeout: options.timeout
    });
    const [seconds, nanos] = process.hrtime(started);
    const {
      size
    } = await _appiumSupport.fs.stat(apkPath);

    _logger.default.info(`The upload of '${_path.default.basename(apkPath)}' (${_appiumSupport.util.toReadableSizeString(size)}) ` + `took ${(seconds + nanos / 1e9).toFixed(3)}s`);
  }

  if (!this.remoteAppsCache) {
    this.remoteAppsCache = new _lruCache.default({
      max: this.remoteAppsCacheLimit
    });
  }

  _lodash.default.difference(this.remoteAppsCache.keys(), remoteCachedFiles.map(toHash)).forEach(hash => this.remoteAppsCache.del(hash));

  this.remoteAppsCache.set(appHash, remotePath);
  const entriesToCleanup = remoteCachedFiles.map(x => _path.default.posix.join(REMOTE_CACHE_ROOT, x)).filter(x => !this.remoteAppsCache.has(toHash(x))).slice(this.remoteAppsCacheLimit - this.remoteAppsCache.keys().length);

  if (!_lodash.default.isEmpty(entriesToCleanup)) {
    try {
      await this.shell(['rm', '-f', ...entriesToCleanup]);

      _logger.default.debug(`Deleted ${entriesToCleanup.length} expired application cache entries`);
    } catch (e) {
      _logger.default.warn(`Cannot delete ${entriesToCleanup.length} expired application cache entries. ` + `Original error: ${e.message}`);
    }
  }

  return remotePath;
};

apkUtilsMethods.install = async function install(appPath, options = {}) {
  if (appPath.endsWith(_helpers.APKS_EXTENSION)) {
    return await this.installApks(appPath, options);
  }

  options = _lodash.default.cloneDeep(options);

  _lodash.default.defaults(options, {
    replace: true,
    timeout: this.adbExecTimeout === _helpers.DEFAULT_ADB_EXEC_TIMEOUT ? _helpers.APK_INSTALL_TIMEOUT : this.adbExecTimeout,
    timeoutCapName: 'androidInstallTimeout'
  });

  const installArgs = (0, _helpers.buildInstallArgs)((await this.getApiLevel()), options);
  const installOpts = {
    timeout: options.timeout,
    timeoutCapName: options.timeoutCapName
  };

  let performAppInstall = async () => await this.adbExec(['install', ...installArgs, appPath], installOpts);

  if (this.remoteAppsCacheLimit > 0) {
    const cachedRemotePath = await this.cacheApk(appPath, {
      timeout: options.timeout
    });

    performAppInstall = async () => await this.shell(['pm', 'install', ...installArgs, cachedRemotePath], installOpts);
  }

  try {
    const started = process.hrtime();
    const output = await performAppInstall();
    const [seconds, nanos] = process.hrtime(started);

    _logger.default.info(`The installation of '${_path.default.basename(appPath)}' took ${(seconds + nanos / 1e9).toFixed(3)}s`);

    const truncatedOutput = !_lodash.default.isString(output) || output.length <= 300 ? output : `${output.substr(0, 150)}...${output.substr(output.length - 150)}`;

    _logger.default.debug(`Install command stdout: ${truncatedOutput}`);

    if (/\[INSTALL[A-Z_]+FAILED[A-Z_]+\]/.test(output)) {
      if (this.isTestPackageOnlyError(output)) {
        const msg = `Set 'allowTestPackages' capability to true in order to allow test packages installation.`;

        _logger.default.warn(msg);

        throw new Error(`${output}\n${msg}`);
      }

      throw new Error(output);
    }
  } catch (err) {
    if (!err.message.includes('INSTALL_FAILED_ALREADY_EXISTS')) {
      throw err;
    }

    _logger.default.debug(`Application '${appPath}' already installed. Continuing.`);
  }
};

apkUtilsMethods.getApplicationInstallState = async function getApplicationInstallState(appPath, pkg = null) {
  let apkInfo = null;

  if (!pkg) {
    apkInfo = await this.getApkInfo(appPath);
    pkg = apkInfo.name;
  }

  if (!pkg) {
    _logger.default.warn(`Cannot read the package name of '${appPath}'`);

    return this.APP_INSTALL_STATE.UNKNOWN;
  }

  if (!(await this.isAppInstalled(pkg))) {
    _logger.default.debug(`App '${appPath}' is not installed`);

    return this.APP_INSTALL_STATE.NOT_INSTALLED;
  }

  const {
    versionCode: pkgVersionCode,
    versionName: pkgVersionNameStr
  } = await this.getPackageInfo(pkg);

  const pkgVersionName = _semver.default.valid(_semver.default.coerce(pkgVersionNameStr));

  if (!apkInfo) {
    apkInfo = await this.getApkInfo(appPath);
  }

  const {
    versionCode: apkVersionCode,
    versionName: apkVersionNameStr
  } = apkInfo;

  const apkVersionName = _semver.default.valid(_semver.default.coerce(apkVersionNameStr));

  if (!_lodash.default.isInteger(apkVersionCode) || !_lodash.default.isInteger(pkgVersionCode)) {
    _logger.default.warn(`Cannot read version codes of '${appPath}' and/or '${pkg}'`);

    if (!_lodash.default.isString(apkVersionName) || !_lodash.default.isString(pkgVersionName)) {
      _logger.default.warn(`Cannot read version names of '${appPath}' and/or '${pkg}'`);

      return this.APP_INSTALL_STATE.UNKNOWN;
    }
  }

  if (_lodash.default.isInteger(apkVersionCode) && _lodash.default.isInteger(pkgVersionCode)) {
    if (pkgVersionCode > apkVersionCode) {
      _logger.default.debug(`The version code of the installed '${pkg}' is greater than the application version code (${pkgVersionCode} > ${apkVersionCode})`);

      return this.APP_INSTALL_STATE.NEWER_VERSION_INSTALLED;
    }

    if (pkgVersionCode === apkVersionCode) {
      if (_lodash.default.isString(apkVersionName) && _lodash.default.isString(pkgVersionName) && _semver.default.satisfies(pkgVersionName, `>=${apkVersionName}`)) {
        _logger.default.debug(`The version name of the installed '${pkg}' is greater or equal to the application version name ('${pkgVersionName}' >= '${apkVersionName}')`);

        return _semver.default.satisfies(pkgVersionName, `>${apkVersionName}`) ? this.APP_INSTALL_STATE.NEWER_VERSION_INSTALLED : this.APP_INSTALL_STATE.SAME_VERSION_INSTALLED;
      }

      if (!_lodash.default.isString(apkVersionName) || !_lodash.default.isString(pkgVersionName)) {
        _logger.default.debug(`The version name of the installed '${pkg}' is equal to application version name (${pkgVersionCode} === ${apkVersionCode})`);

        return this.APP_INSTALL_STATE.SAME_VERSION_INSTALLED;
      }
    }
  } else if (_lodash.default.isString(apkVersionName) && _lodash.default.isString(pkgVersionName) && _semver.default.satisfies(pkgVersionName, `>=${apkVersionName}`)) {
    _logger.default.debug(`The version name of the installed '${pkg}' is greater or equal to the application version name ('${pkgVersionName}' >= '${apkVersionName}')`);

    return _semver.default.satisfies(pkgVersionName, `>${apkVersionName}`) ? this.APP_INSTALL_STATE.NEWER_VERSION_INSTALLED : this.APP_INSTALL_STATE.SAME_VERSION_INSTALLED;
  }

  _logger.default.debug(`The installed '${pkg}' package is older than '${appPath}' (${pkgVersionCode} < ${apkVersionCode} or '${pkgVersionName}' < '${apkVersionName}')'`);

  return this.APP_INSTALL_STATE.OLDER_VERSION_INSTALLED;
};

apkUtilsMethods.installOrUpgrade = async function installOrUpgrade(appPath, pkg = null, options = {}) {
  if (!pkg) {
    const apkInfo = await this.getApkInfo(appPath);
    pkg = apkInfo.name;
  }

  const appState = await this.getApplicationInstallState(appPath, pkg);

  switch (appState) {
    case this.APP_INSTALL_STATE.NOT_INSTALLED:
      _logger.default.debug(`Installing '${appPath}'`);

      await this.install(appPath, Object.assign({}, options, {
        replace: false
      }));
      return;

    case this.APP_INSTALL_STATE.NEWER_VERSION_INSTALLED:
    case this.APP_INSTALL_STATE.SAME_VERSION_INSTALLED:
      _logger.default.debug(`There is no need to install/upgrade '${appPath}'`);

      return;

    case this.APP_INSTALL_STATE.OLDER_VERSION_INSTALLED:
      _logger.default.debug(`Executing upgrade of '${appPath}'`);

      break;

    default:
      _logger.default.debug(`The current install state of '${appPath}' is unknown. Installing anyway`);

      break;
  }

  try {
    await this.install(appPath, Object.assign({}, options, {
      replace: true
    }));
  } catch (err) {
    _logger.default.warn(`Cannot upgrade '${pkg}' because of '${err.message}'. Trying full reinstall`);

    if (!(await this.uninstallApk(pkg))) {
      throw new Error(`'${pkg}' package cannot be uninstalled`);
    }

    await this.install(appPath, Object.assign({}, options, {
      replace: false
    }));
  }
};

apkUtilsMethods.extractStringsFromApk = async function extractStringsFromApk(appPath, language, out) {
  _logger.default.debug(`Extracting strings from for language: ${language || 'default'}`);

  const originalAppPath = appPath;

  if (appPath.endsWith(_helpers.APKS_EXTENSION)) {
    appPath = await this.extractLanguageApk(appPath, language);
  }

  let apkStrings = {};
  let configMarker;

  try {
    await this.initAapt();
    configMarker = await (0, _helpers.formatConfigMarker)(async () => {
      const {
        stdout
      } = await (0, _teen_process.exec)(this.binaries.aapt, ['d', 'configurations', appPath]);
      return stdout.split(_os.default.EOL);
    }, language, '(default)');
    const {
      stdout
    } = await (0, _teen_process.exec)(this.binaries.aapt, ['d', '--values', 'resources', appPath]);
    apkStrings = (0, _helpers.parseAaptStrings)(stdout, configMarker);
  } catch (e) {
    _logger.default.debug('Cannot extract resources using aapt. Trying aapt2. ' + `Original error: ${e.stderr || e.message}`);

    await this.initAapt2();
    configMarker = await (0, _helpers.formatConfigMarker)(async () => {
      const apkanalyzerPath = await (0, _helpers.getApkanalyzerForOs)(this);
      const {
        stdout
      } = await (0, _teen_process.exec)(apkanalyzerPath, ['resources', 'configs', '--type', 'string', appPath], {
        shell: true,
        cwd: _path.default.dirname(apkanalyzerPath)
      });
      return stdout.split(_os.default.EOL);
    }, language, '');

    try {
      const {
        stdout
      } = await (0, _teen_process.exec)(this.binaries.aapt2, ['dump', appPath]);
      apkStrings = (0, _helpers.parseAapt2Strings)(stdout, configMarker);
    } catch (e) {
      throw new Error(`Cannot extract resources from '${originalAppPath}'. ` + `Original error: ${e.message}`);
    }
  }

  if (_lodash.default.isEmpty(apkStrings)) {
    _logger.default.warn(`No strings have been found in '${originalAppPath}' resources ` + `for '${configMarker || 'default'}' configuration`);
  } else {
    _logger.default.info(`Successfully extracted ${_lodash.default.keys(apkStrings).length} strings from ` + `'${originalAppPath}' resources for '${configMarker || 'default'}' configuration`);
  }

  const localPath = _path.default.resolve(out, 'strings.json');

  await (0, _appiumSupport.mkdirp)(out);
  await _appiumSupport.fs.writeFile(localPath, JSON.stringify(apkStrings, null, 2), 'utf-8');
  return {
    apkStrings,
    localPath
  };
};

apkUtilsMethods.getDeviceLanguage = async function getDeviceLanguage() {
  let language;

  if ((await this.getApiLevel()) < 23) {
    language = await this.getDeviceSysLanguage();

    if (!language) {
      language = await this.getDeviceProductLanguage();
    }
  } else {
    language = (await this.getDeviceLocale()).split('-')[0];
  }

  return language;
};

apkUtilsMethods.getDeviceCountry = async function getDeviceCountry() {
  let country = await this.getDeviceSysCountry();

  if (!country) {
    country = await this.getDeviceProductCountry();
  }

  return country;
};

apkUtilsMethods.getDeviceLocale = async function getDeviceLocale() {
  let locale = await this.getDeviceSysLocale();

  if (!locale) {
    locale = await this.getDeviceProductLocale();
  }

  return locale;
};

apkUtilsMethods.setDeviceLocale = async function setDeviceLocale(locale) {
  const validateLocale = new RegExp(/[a-zA-Z]+-[a-zA-Z0-9]+/);

  if (!validateLocale.test(locale)) {
    _logger.default.warn(`setDeviceLocale requires the following format: en-US or ja-JP`);

    return;
  }

  let split_locale = locale.split('-');
  await this.setDeviceLanguageCountry(split_locale[0], split_locale[1]);
};

apkUtilsMethods.ensureCurrentLocale = async function ensureCurrentLocale(language, country, script = null) {
  const hasLanguage = _lodash.default.isString(language);

  const hasCountry = _lodash.default.isString(country);

  if (!hasLanguage && !hasCountry) {
    _logger.default.warn('ensureCurrentLocale requires language or country');

    return false;
  }

  language = (language || '').toLowerCase();
  country = (country || '').toLowerCase();
  const apiLevel = await this.getApiLevel();
  return await (0, _asyncbox.retryInterval)(5, 1000, async () => {
    try {
      if (apiLevel < 23) {
        let curLanguage, curCountry;

        if (hasLanguage) {
          curLanguage = (await this.getDeviceLanguage()).toLowerCase();

          if (!hasCountry && language === curLanguage) {
            return true;
          }
        }

        if (hasCountry) {
          curCountry = (await this.getDeviceCountry()).toLowerCase();

          if (!hasLanguage && country === curCountry) {
            return true;
          }
        }

        if (language === curLanguage && country === curCountry) {
          return true;
        }
      } else {
        const curLocale = (await this.getDeviceLocale()).toLowerCase();
        const localeCode = script ? `${language}-${script.toLowerCase()}-${country}` : `${language}-${country}`;

        if (localeCode === curLocale) {
          _logger.default.debug(`Requested locale is equal to current locale: '${curLocale}'`);

          return true;
        }
      }

      return false;
    } catch (err) {
      _logger.default.error(`Unable to check device localization: ${err.message}`);

      _logger.default.debug('Restarting ADB and retrying...');

      await this.restartAdb();
      throw err;
    }
  });
};

apkUtilsMethods.setDeviceLanguageCountry = async function setDeviceLanguageCountry(language, country, script = null) {
  let hasLanguage = language && _lodash.default.isString(language);

  let hasCountry = country && _lodash.default.isString(country);

  if (!hasLanguage || !hasCountry) {
    _logger.default.warn(`setDeviceLanguageCountry requires language and country at least`);

    _logger.default.warn(`Got language: '${language}' and country: '${country}'`);

    return;
  }

  let apiLevel = await this.getApiLevel();
  language = (language || '').toLowerCase();
  country = (country || '').toUpperCase();

  if (apiLevel < 23) {
    let curLanguage = (await this.getDeviceLanguage()).toLowerCase();
    let curCountry = (await this.getDeviceCountry()).toUpperCase();

    if (language !== curLanguage || country !== curCountry) {
      await this.setDeviceSysLocaleViaSettingApp(language, country);
    }
  } else {
    let curLocale = await this.getDeviceLocale();
    const localeCode = script ? `${language}-${script}-${country}` : `${language}-${country}`;

    _logger.default.debug(`Current locale: '${curLocale}'; requested locale: '${localeCode}'`);

    if (localeCode.toLowerCase() !== curLocale.toLowerCase()) {
      await this.setDeviceSysLocaleViaSettingApp(language, country, script);
    }
  }
};

apkUtilsMethods.getApkInfo = async function getApkInfo(appPath) {
  if (!(await _appiumSupport.fs.exists(appPath))) {
    throw new Error(`The file at path ${appPath} does not exist or is not accessible`);
  }

  if (appPath.endsWith(_helpers.APKS_EXTENSION)) {
    appPath = await this.extractBaseApk(appPath);
  }

  try {
    const apkanalyzerPath = await (0, _helpers.getApkanalyzerForOs)(this);
    const args = ['manifest', 'print', appPath];

    _logger.default.debug(`Starting '${apkanalyzerPath}' with args ${JSON.stringify(args)}`);

    const {
      stdout
    } = await (0, _teen_process.exec)(apkanalyzerPath, args, {
      shell: true,
      cwd: _path.default.dirname(apkanalyzerPath)
    });
    const {
      pkg,
      versionName,
      versionCode
    } = (0, _helpers.parseManifest)(stdout);
    return {
      name: pkg,
      versionCode,
      versionName
    };
  } catch (e) {
    _logger.default.info(`Cannot extract apk info using apkanalyzer. Falling back to aapt. ` + `Original error: ${e.stderr || e.message}`);

    await this.initAapt();

    try {
      const {
        stdout
      } = await (0, _teen_process.exec)(this.binaries.aapt, ['d', 'badging', appPath]);
      const matches = new RegExp(/package: name='([^']+)' versionCode='(\d+)' versionName='([^']+)'/).exec(stdout);

      if (matches) {
        return {
          name: matches[1],
          versionCode: parseInt(matches[2], 10),
          versionName: matches[3]
        };
      }
    } catch (err) {
      _logger.default.warn(`Error "${err.stderr || err.message}" while getting badging info`);
    }
  }

  return {};
};

apkUtilsMethods.getPackageInfo = async function getPackageInfo(pkg) {
  _logger.default.debug(`Getting package info for '${pkg}'`);

  let result = {
    name: pkg
  };

  try {
    const stdout = await this.shell(['dumpsys', 'package', pkg]);
    const versionNameMatch = new RegExp(/versionName=([\d+.]+)/).exec(stdout);

    if (versionNameMatch) {
      result.versionName = versionNameMatch[1];
    }

    const versionCodeMatch = new RegExp(/versionCode=(\d+)/).exec(stdout);

    if (versionCodeMatch) {
      result.versionCode = parseInt(versionCodeMatch[1], 10);
    }

    return result;
  } catch (err) {
    _logger.default.warn(`Error '${err.message}' while dumping package info`);
  }

  return result;
};

apkUtilsMethods.pullApk = async function pullApk(pkg, tmpDir) {
  const pkgPath = (await this.adbExec(['shell', 'pm', 'path', pkg])).replace('package:', '');

  const tmpApp = _path.default.resolve(tmpDir, `${pkg}.apk`);

  await this.pull(pkgPath, tmpApp);

  _logger.default.debug(`Pulled app for package '${pkg}' to '${tmpApp}'`);

  return tmpApp;
};

var _default = apkUtilsMethods;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi90b29scy9hcGstdXRpbHMuanMiXSwibmFtZXMiOlsiYXBrVXRpbHNNZXRob2RzIiwiQUNUSVZJVElFU19UUk9VQkxFU0hPT1RJTkdfTElOSyIsIkFQUF9JTlNUQUxMX1NUQVRFIiwiVU5LTk9XTiIsIk5PVF9JTlNUQUxMRUQiLCJORVdFUl9WRVJTSU9OX0lOU1RBTExFRCIsIlNBTUVfVkVSU0lPTl9JTlNUQUxMRUQiLCJPTERFUl9WRVJTSU9OX0lOU1RBTExFRCIsIlJFTU9URV9DQUNIRV9ST09UIiwiaXNBcHBJbnN0YWxsZWQiLCJwa2ciLCJsb2ciLCJkZWJ1ZyIsImluc3RhbGxlZFBhdHRlcm4iLCJSZWdFeHAiLCJfIiwiZXNjYXBlUmVnRXhwIiwic3Rkb3V0Iiwic2hlbGwiLCJpc0luc3RhbGxlZCIsInRlc3QiLCJlIiwiRXJyb3IiLCJtZXNzYWdlIiwic3RhcnRVcmkiLCJ1cmkiLCJhcmdzIiwicmVwbGFjZSIsInJlcyIsInRvTG93ZXJDYXNlIiwiaW5jbHVkZXMiLCJzdGFydEFwcCIsInN0YXJ0QXBwT3B0aW9ucyIsImFjdGl2aXR5IiwiY2xvbmUiLCJkZWZhdWx0cyIsIndhaXRQa2ciLCJ3YWl0Rm9yTGF1bmNoIiwid2FpdEFjdGl2aXR5IiwicmV0cnkiLCJzdG9wQXBwIiwiYXBpTGV2ZWwiLCJnZXRBcGlMZXZlbCIsImNtZCIsInNoZWxsT3B0cyIsImlzSW50ZWdlciIsIndhaXREdXJhdGlvbiIsInRpbWVvdXQiLCJzdGFydHNXaXRoIiwid2FpdEZvckFjdGl2aXR5IiwiZHVtcFdpbmRvd3MiLCJkdW1wc3lzQXJnIiwiZ2V0Rm9jdXNlZFBhY2thZ2VBbmRBY3Rpdml0eSIsIm51bGxGb2N1c2VkQXBwUmUiLCJmb2N1c2VkQXBwUmUiLCJudWxsQ3VycmVudEZvY3VzUmUiLCJjdXJyZW50Rm9jdXNBcHBSZSIsInBhdHRlcm4iLCJtYXRjaCIsImV4ZWMiLCJhcHBQYWNrYWdlIiwidHJpbSIsImFwcEFjdGl2aXR5Iiwid2FpdEZvckFjdGl2aXR5T3JOb3QiLCJ3YWl0Rm9yU3RvcCIsIndhaXRNcyIsInNwbGl0TmFtZXMiLCJuYW1lcyIsInNwbGl0IiwibWFwIiwibmFtZSIsImFsbFBhY2thZ2VzIiwiYWxsQWN0aXZpdGllcyIsInBvc3NpYmxlQWN0aXZpdHlOYW1lcyIsIm9uZUFjdGl2aXR5IiwiY3VycmVudFBrZyIsInB1c2giLCJqb2luIiwicG9zc2libGVBY3Rpdml0eVBhdHRlcm5zIiwicG9zc2libGVBY3Rpdml0eU5hbWUiLCJyZXRyaWVzIiwicGFyc2VJbnQiLCJpc05hTiIsImZ1bGx5UXVhbGlmaWVkQWN0aXZpdHkiLCJmb3VuZEFjdCIsImZpbmRJbmRleCIsInBvc3NpYmxlUGF0dGVybiIsImFjdCIsIndhaXRGb3JOb3RBY3Rpdml0eSIsInVuaW5zdGFsbEFwayIsIm9wdGlvbnMiLCJpbmZvIiwia2VlcERhdGEiLCJmb3JjZVN0b3AiLCJhZGJFeGVjIiwiaW5zdGFsbEZyb21EZXZpY2VQYXRoIiwiYXBrUGF0aE9uRGV2aWNlIiwib3B0cyIsImluZGV4T2YiLCJjYWNoZUFwayIsImFwa1BhdGgiLCJhcHBIYXNoIiwiZnMiLCJoYXNoIiwicmVtb3RlUGF0aCIsInBhdGgiLCJwb3NpeCIsInJlbW90ZUNhY2hlZEZpbGVzIiwiZXJyb3JNYXJrZXIiLCJsc091dHB1dCIsIl9hcmVFeHRlbmRlZExzT3B0aW9uc1N1cHBvcnRlZCIsImlzQm9vbGVhbiIsImlzU3RyaW5nIiwic3Vic3RyaW5nIiwieCIsImZpbHRlciIsIkJvb2xlYW4iLCJsZW5ndGgiLCJ0b0hhc2giLCJwYXJzZSIsImZpbmQiLCJzdGFydGVkIiwicHJvY2VzcyIsImhydGltZSIsInNlY29uZHMiLCJuYW5vcyIsInNpemUiLCJzdGF0IiwiYmFzZW5hbWUiLCJ1dGlsIiwidG9SZWFkYWJsZVNpemVTdHJpbmciLCJ0b0ZpeGVkIiwicmVtb3RlQXBwc0NhY2hlIiwiTFJVIiwibWF4IiwicmVtb3RlQXBwc0NhY2hlTGltaXQiLCJkaWZmZXJlbmNlIiwia2V5cyIsImZvckVhY2giLCJkZWwiLCJzZXQiLCJlbnRyaWVzVG9DbGVhbnVwIiwiaGFzIiwic2xpY2UiLCJpc0VtcHR5Iiwid2FybiIsImluc3RhbGwiLCJhcHBQYXRoIiwiZW5kc1dpdGgiLCJBUEtTX0VYVEVOU0lPTiIsImluc3RhbGxBcGtzIiwiY2xvbmVEZWVwIiwiYWRiRXhlY1RpbWVvdXQiLCJERUZBVUxUX0FEQl9FWEVDX1RJTUVPVVQiLCJBUEtfSU5TVEFMTF9USU1FT1VUIiwidGltZW91dENhcE5hbWUiLCJpbnN0YWxsQXJncyIsImluc3RhbGxPcHRzIiwicGVyZm9ybUFwcEluc3RhbGwiLCJjYWNoZWRSZW1vdGVQYXRoIiwib3V0cHV0IiwidHJ1bmNhdGVkT3V0cHV0Iiwic3Vic3RyIiwiaXNUZXN0UGFja2FnZU9ubHlFcnJvciIsIm1zZyIsImVyciIsImdldEFwcGxpY2F0aW9uSW5zdGFsbFN0YXRlIiwiYXBrSW5mbyIsImdldEFwa0luZm8iLCJ2ZXJzaW9uQ29kZSIsInBrZ1ZlcnNpb25Db2RlIiwidmVyc2lvbk5hbWUiLCJwa2dWZXJzaW9uTmFtZVN0ciIsImdldFBhY2thZ2VJbmZvIiwicGtnVmVyc2lvbk5hbWUiLCJzZW12ZXIiLCJ2YWxpZCIsImNvZXJjZSIsImFwa1ZlcnNpb25Db2RlIiwiYXBrVmVyc2lvbk5hbWVTdHIiLCJhcGtWZXJzaW9uTmFtZSIsInNhdGlzZmllcyIsImluc3RhbGxPclVwZ3JhZGUiLCJhcHBTdGF0ZSIsIk9iamVjdCIsImFzc2lnbiIsImV4dHJhY3RTdHJpbmdzRnJvbUFwayIsImxhbmd1YWdlIiwib3V0Iiwib3JpZ2luYWxBcHBQYXRoIiwiZXh0cmFjdExhbmd1YWdlQXBrIiwiYXBrU3RyaW5ncyIsImNvbmZpZ01hcmtlciIsImluaXRBYXB0IiwiYmluYXJpZXMiLCJhYXB0Iiwib3MiLCJFT0wiLCJzdGRlcnIiLCJpbml0QWFwdDIiLCJhcGthbmFseXplclBhdGgiLCJjd2QiLCJkaXJuYW1lIiwiYWFwdDIiLCJsb2NhbFBhdGgiLCJyZXNvbHZlIiwid3JpdGVGaWxlIiwiSlNPTiIsInN0cmluZ2lmeSIsImdldERldmljZUxhbmd1YWdlIiwiZ2V0RGV2aWNlU3lzTGFuZ3VhZ2UiLCJnZXREZXZpY2VQcm9kdWN0TGFuZ3VhZ2UiLCJnZXREZXZpY2VMb2NhbGUiLCJnZXREZXZpY2VDb3VudHJ5IiwiY291bnRyeSIsImdldERldmljZVN5c0NvdW50cnkiLCJnZXREZXZpY2VQcm9kdWN0Q291bnRyeSIsImxvY2FsZSIsImdldERldmljZVN5c0xvY2FsZSIsImdldERldmljZVByb2R1Y3RMb2NhbGUiLCJzZXREZXZpY2VMb2NhbGUiLCJ2YWxpZGF0ZUxvY2FsZSIsInNwbGl0X2xvY2FsZSIsInNldERldmljZUxhbmd1YWdlQ291bnRyeSIsImVuc3VyZUN1cnJlbnRMb2NhbGUiLCJzY3JpcHQiLCJoYXNMYW5ndWFnZSIsImhhc0NvdW50cnkiLCJjdXJMYW5ndWFnZSIsImN1ckNvdW50cnkiLCJjdXJMb2NhbGUiLCJsb2NhbGVDb2RlIiwiZXJyb3IiLCJyZXN0YXJ0QWRiIiwidG9VcHBlckNhc2UiLCJzZXREZXZpY2VTeXNMb2NhbGVWaWFTZXR0aW5nQXBwIiwiZXhpc3RzIiwiZXh0cmFjdEJhc2VBcGsiLCJtYXRjaGVzIiwicmVzdWx0IiwidmVyc2lvbk5hbWVNYXRjaCIsInZlcnNpb25Db2RlTWF0Y2giLCJwdWxsQXBrIiwidG1wRGlyIiwicGtnUGF0aCIsInRtcEFwcCIsInB1bGwiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQUE7O0FBSUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBRUEsSUFBSUEsZUFBZSxHQUFHLEVBQXRCO0FBRUEsTUFBTUMsK0JBQStCLEdBQ25DLHlHQURGO0FBRUFELGVBQWUsQ0FBQ0UsaUJBQWhCLEdBQW9DO0FBQ2xDQyxFQUFBQSxPQUFPLEVBQUUsU0FEeUI7QUFFbENDLEVBQUFBLGFBQWEsRUFBRSxjQUZtQjtBQUdsQ0MsRUFBQUEsdUJBQXVCLEVBQUUsdUJBSFM7QUFJbENDLEVBQUFBLHNCQUFzQixFQUFF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TyxnQkFBSixFQUFzQjtBQUNwQkYsTUFBQUEsTUFBTSxDQUFDdEUsV0FBUCxHQUFxQnhGLFFBQVEsQ0FBQ2dLLGdCQUFnQixDQUFDLENBQUQsQ0FBakIsRUFBc0IsRUFBdEIsQ0FBN0I7QUFDRDs7QUFDRCxXQUFPRixNQUFQO0FBQ0QsR0FYRCxDQVdFLE9BQU8xRSxHQUFQLEVBQVk7QUFDWjFKLG9CQUFJc0ksSUFBSixDQUFVLFVBQVNvQixHQUFHLENBQUM5SSxPQUFRLDhCQUEvQjtBQUNEOztBQUNELFNBQU93TixNQUFQO0FBQ0QsQ0FsQkQ7O0FBb0JBL08sZUFBZSxDQUFDa1AsT0FBaEIsR0FBMEIsZUFBZUEsT0FBZixDQUF3QnhPLEdBQXhCLEVBQTZCeU8sTUFBN0IsRUFBcUM7QUFDN0QsUUFBTUMsT0FBTyxHQUFHLENBQUMsTUFBTSxLQUFLdEosT0FBTCxDQUFhLENBQUMsT0FBRCxFQUFVLElBQVYsRUFBZ0IsTUFBaEIsRUFBd0JwRixHQUF4QixDQUFiLENBQVAsRUFBbURpQixPQUFuRCxDQUEyRCxVQUEzRCxFQUF1RSxFQUF2RSxDQUFoQjs7QUFDQSxRQUFNME4sTUFBTSxHQUFHNUksY0FBS29HLE9BQUwsQ0FBYXNDLE1BQWIsRUFBc0IsR0FBRXpPLEdBQUksTUFBNUIsQ0FBZjs7QUFDQSxRQUFNLEtBQUs0TyxJQUFMLENBQVVGLE9BQVYsRUFBbUJDLE1BQW5CLENBQU47O0FBQ0ExTyxrQkFBSUMsS0FBSixDQUFXLDJCQUEwQkYsR0FBSSxTQUFRMk8sTUFBTyxHQUF4RDs7QUFDQSxTQUFPQSxNQUFQO0FBQ0QsQ0FORDs7ZUFTZXJQLGUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBidWlsZFN0YXJ0Q21kLCBBUEtTX0VYVEVOU0lPTiwgYnVpbGRJbnN0YWxsQXJncyxcbiAgQVBLX0lOU1RBTExfVElNRU9VVCwgREVGQVVMVF9BREJfRVhFQ19USU1FT1VULCBnZXRBcGthbmFseXplckZvck9zLFxuICBwYXJzZU1hbmlmZXN0LCBwYXJzZUFhcHRTdHJpbmdzLCBwYXJzZUFhcHQyU3RyaW5ncywgZm9ybWF0Q29uZmlnTWFya2VyIH0gZnJvbSAnLi4vaGVscGVycy5qcyc7XG5pbXBvcnQgeyBleGVjIH0gZnJvbSAndGVlbl9wcm9jZXNzJztcbmltcG9ydCBsb2cgZnJvbSAnLi4vbG9nZ2VyLmpzJztcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCB7IHJldHJ5SW50ZXJ2YWwgfSBmcm9tICdhc3luY2JveCc7XG5pbXBvcnQgeyBmcywgdXRpbCwgbWtkaXJwIH0gZnJvbSAnYXBwaXVtLXN1cHBvcnQnO1xuaW1wb3J0IHNlbXZlciBmcm9tICdzZW12ZXInO1xuaW1wb3J0IG9zIGZyb20gJ29zJztcbmltcG9ydCBMUlUgZnJvbSAnbHJ1LWNhY2hlJztcblxubGV0IGFwa1V0aWxzTWV0aG9kcyA9IHt9O1xuXG5jb25zdCBBQ1RJVklUSUVTX1RST1VCTEVTSE9PVElOR19MSU5LID1cbiAgJ2h0dHBzOi8vZ2l0aHViLmNvbS9hcHBpdW0vYXBwaXVtL2Jsb2IvbWFzdGVyL2RvY3MvZW4vd3JpdGluZy1ydW5uaW5nLWFwcGl1bS9hbmRyb2lkL2FjdGl2aXR5LXN0YXJ0dXAubWQnO1xuYXBrVXRpbHNNZXRob2RzLkFQUF9JTlNUQUxMX1NUQVRFID0ge1xuICBVTktOT1dOOiAndW5rbm93bicsXG4gIE5PVF9JTlNUQUxMRUQ6ICdub3RJbnN0YWxsZWQnLFxuICBORVdFUl9WRVJTSU9OX0lOU1RBTExFRDogJ25ld2VyVmVyc2lvbkluc3RhbGxlZCcsXG4gIFNBTUVfVkVSU0lPTl9JTlNUQUxMRUQ6ICdzYW1lVmVyc2lvbkluc3RhbGxlZCcsXG4gIE9MREVSX1ZFUlNJT05fSU5TVEFMTEVEOiAnb2xkZXJWZXJzaW9uSW5zdGFsbGVkJyxcbn07XG5jb25zdCBSRU1PVEVfQ0FDSEVfUk9PVCA9ICcvZGF0YS9sb2NhbC90bXAvYXBwaXVtX2NhY2hlJztcblxuXG4vKipcbiAqIENoZWNrIHdoZXRoZXIgdGhlIHBhcnRpY3VsYXIgcGFja2FnZSBpcyBwcmVzZW50IG9uIHRoZSBkZXZpY2UgdW5kZXIgdGVzdC5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gcGtnIC0gVGhlIG5hbWUgb2YgdGhlIHBhY2thZ2UgdG8gY2hlY2suXG4gKiBAcmV0dXJuIHtib29sZWFufSBUcnVlIGlmIHRoZSBwYWNrYWdlIGlzIGluc3RhbGxlZC5cbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGVyZSB3YXMgYW4gZXJyb3Igd2hpbGUgZGV0ZWN0aW5nIGFwcGxpY2F0aW9uIHN0YXRlXG4gKi9cbmFwa1V0aWxzTWV0aG9kcy5pc0FwcEluc3RhbGxlZCA9IGFzeW5jIGZ1bmN0aW9uIGlzQXBwSW5zdGFsbGVkIChwa2cpIHtcbiAgbG9nLmRlYnVnKGBHZXR0aW5nIGluc3RhbGwgc3RhdHVzIGZvciAke3BrZ31gKTtcbiAgY29uc3QgaW5zdGFsbGVkUGF0dGVybiA9IG5ldyBSZWdFeHAoYF5cXFxccypQYWNrYWdlXFxcXHMrXFxcXFske18uZXNjYXBlUmVnRXhwKHBrZyl9XFxcXF1bXjpdKzokYCwgJ20nKTtcbiAgdHJ5IHtcbiAgICBjb25zdCBzdGRvdXQgPSBhd2FpdCB0aGlzLnNoZWxsKFsnZHVtcHN5cycsICdwYWNrYWdlJywgcGtnXSk7XG4gICAgY29uc3QgaXNJbnN0YWxsZWQgPSBpbnN0YWxsZWRQYXR0ZXJuLnRlc3Qoc3Rkb3V0KTtcbiAgICBsb2cuZGVidWcoYCcke3BrZ30nIGlzJHshaXNJbnN0YWxsZWQgPyAnIG5vdCcgOiAnJ30gaW5zdGFsbGVkYCk7XG4gICAgcmV0dXJuIGlzSW5zdGFsbGVkO1xuICB9IGNhdGNoIChlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBFcnJvciBmaW5kaW5nIGlmICcke3BrZ30nIGlzIGluc3RhbGxlZC4gT3JpZ2luYWwgZXJyb3I6ICR7ZS5tZXNzYWdlfWApO1xuICB9XG59O1xuXG4vKipcbiAqIFN0YXJ0IHRoZSBwYXJ0aWN1bGFyIFVSSSBvbiB0aGUgZGV2aWNlIHVuZGVyIHRlc3QuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHVyaSAtIFRoZSBuYW1lIG9mIFVSSSB0byBzdGFydC5cbiAqIEBwYXJhbSB7c3RyaW5nfSBwa2cgLSBUaGUgbmFtZSBvZiB0aGUgcGFja2FnZSB0byBzdGFydCB0aGUgVVJJIHdpdGguXG4gKi9cbmFwa1V0aWxzTWV0aG9kcy5zdGFydFVyaSA9IGFzeW5jIGZ1bmN0aW9uIHN0YXJ0VXJpICh1cmksIHBrZykge1xuICBpZiAoIXVyaSB8fCAhcGtnKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdVUkkgYW5kIHBhY2thZ2UgYXJndW1lbnRzIGFyZSByZXF1aXJlZCcpO1xuICB9XG5cbiAgY29uc3QgYXJncyA9IFtcbiAgICAnYW0nLCAnc3RhcnQnLFxuICAgICctVycsXG4gICAgJy1hJywgJ2FuZHJvaWQuaW50ZW50LmFjdGlvbi5WSUVXJyxcbiAgICAnLWQnLCB1cmkucmVwbGFjZSgvJi9nLCAnXFxcXCYnKSxcbiAgICBwa2csXG4gIF07XG4gIHRyeSB7XG4gICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy5zaGVsbChhcmdzKTtcbiAgICBpZiAocmVzLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoJ3VuYWJsZSB0byByZXNvbHZlIGludGVudCcpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IocmVzKTtcbiAgICB9XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYEVycm9yIGF0dGVtcHRpbmcgdG8gc3RhcnQgVVJJLiBPcmlnaW5hbCBlcnJvcjogJHtlfWApO1xuICB9XG59O1xuXG4vKipcbiAqIEB0eXBlZGVmIHtPYmplY3R9IFN0YXJ0QXBwT3B0aW9uc1xuICogQHByb3BlcnR5IHshc3RyaW5nfSBhY3Rpdml0eSAtIFRoZSBuYW1lIG9mIHRoZSBtYWluIGFwcGxpY2F0aW9uIGFjdGl2aXR5XG4gKiBAcHJvcGVydHkgeyFzdHJpbmd9IHBrZyAtIFRoZSBuYW1lIG9mIHRoZSBhcHBsaWNhdGlvbiBwYWNrYWdlXG4gKiBAcHJvcGVydHkgez9ib29sZWFufSByZXRyeSBbdHJ1ZV0gLSBJZiB0aGlzIHByb3BlcnR5IGlzIHNldCB0byBgdHJ1ZWBcbiAqIGFuZCB0aGUgYWN0aXZpdHkgbmFtZSBkb2VzIG5vdCBzdGFydCB3aXRoICcuJyB0aGVuIHRoZSBtZXRob2RcbiAqIHdpbGwgdHJ5IHRvIGFkZCB0aGUgbWlzc2luZyBkb3QgYW5kIHN0YXJ0IHRoZSBhY3Rpdml0eSBvbmNlIG1vcmVcbiAqIGlmIHRoZSBmaXJzdCBzdGFydHVwIHRyeSBmYWlscy5cbiAqIEBwcm9wZXJ0eSB7P2Jvb2xlYW59IHN0b3BBcHAgW3RydWVdIC0gU2V0IGl0IHRvIGB0cnVlYCBpbiBvcmRlciB0byBmb3JjZWZ1bGx5XG4gKiBzdG9wIHRoZSBhY3Rpdml0eSBpZiBpdCBpcyBhbHJlYWR5IHJ1bm5pbmcuXG4gKiBAcHJvcGVydHkgez9zdHJpbmd9IHdhaXRQa2cgLSBUaGUgbmFtZSBvZiB0aGUgcGFja2FnZSB0byB3YWl0IHRvIG9uXG4gKiBzdGFydHVwICh0aGlzIG9ubHkgbWFrZXMgc2Vuc2UgaWYgdGhpcyBuYW1lIGlzIGRpZmZlcmVudCBmcm9tIHRoZSBvbmUsIHdoaWNoIGlzIHNldCBhcyBgcGtnYClcbiAqIEBwcm9wZXJ0eSB7P3N0cmluZ30gd2FpdEFjdGl2aXR5IC0gVGhlIG5hbWUgb2YgdGhlIGFjdGl2aXR5IHRvIHdhaXQgdG8gb25cbiAqIHN0YXJ0dXAgKHRoaXMgb25seSBtYWtlcyBzZW5zZSBpZiB0aGlzIG5hbWUgaXMgZGlmZmVyZW50IGZyb20gdGhlIG9uZSwgd2hpY2ggaXMgc2V0IGFzIGBhY3Rpdml0eWApXG4gKiBAcHJvcGVydHkgez9udW1iZXJ9IHdhaXREdXJhdGlvbiAtIFRoZSBudW1iZXIgb2YgbWlsbGlzZWNvbmRzIHRvIHdhaXQgdW50aWwgdGhlXG4gKiBgd2FpdEFjdGl2aXR5YCBpcyBmb2N1c2VkXG4gKiBAcHJvcGVydHkgez9zdHJpbmd8bnVtYmVyfSB1c2VyIC0gVGhlIG51bWJlciBvZiB0aGUgdXNlciBwcm9maWxlIHRvIHN0YXJ0XG4gKiB0aGUgZ2l2ZW4gYWN0aXZpdHkgd2l0aC4gVGhlIGRlZmF1bHQgT1MgdXNlciBwcm9maWxlICh1c3VhbGx5IHplcm8pIGlzIHVzZWRcbiAqIHdoZW4gdGhpcyBwcm9wZXJ0eSBpcyB1bnNldFxuICogQHByb3BlcnR5IHs/Ym9vbGVhbn0gd2FpdEZvckxhdW5jaCBbdHJ1ZV0gLSBpZiBgZmFsc2VgIHRoZW4gYWRiIHdvbid0IHdhaXRcbiAqIGZvciB0aGUgc3RhcnRlZCBhY3Rpdml0eSB0byByZXR1cm4gdGhlIGNvbnRyb2xcbiAqL1xuXG4vKipcbiAqIFN0YXJ0IHRoZSBwYXJ0aWN1bGFyIHBhY2thZ2UvYWN0aXZpdHkgb24gdGhlIGRldmljZSB1bmRlciB0ZXN0LlxuICpcbiAqIEBwYXJhbSB7U3RhcnRBcHBPcHRpb25zfSBzdGFydEFwcE9wdGlvbnMgW3t9XSAtIFN0YXJ0dXAgb3B0aW9ucyBtYXBwaW5nLlxuICogQHJldHVybiB7c3RyaW5nfSBUaGUgb3V0cHV0IG9mIHRoZSBjb3JyZXNwb25kaW5nIGFkYiBjb21tYW5kLlxuICogQHRocm93cyB7RXJyb3J9IElmIHRoZXJlIGlzIGFuIGVycm9yIHdoaWxlIGV4ZWN1dGluZyB0aGUgYWN0aXZpdHlcbiAqL1xuYXBrVXRpbHNNZXRob2RzLnN0YXJ0QXBwID0gYXN5bmMgZnVuY3Rpb24gc3RhcnRBcHAgKHN0YXJ0QXBwT3B0aW9ucyA9IHt9KSB7XG4gIGlmICghc3RhcnRBcHBPcHRpb25zLmFjdGl2aXR5IHx8ICFzdGFydEFwcE9wdGlvbnMucGtnKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdhY3Rpdml0eSBhbmQgcGtnIGFyZSByZXF1aXJlZCB0byBzdGFydCBhbiBhcHBsaWNhdGlvbicpO1xuICB9XG5cbiAgc3RhcnRBcHBPcHRpb25zID0gXy5jbG9uZShzdGFydEFwcE9wdGlvbnMpO1xuICBzdGFydEFwcE9wdGlvbnMuYWN0aXZpdHkgPSBzdGFydEFwcE9wdGlvbnMuYWN0aXZpdHkucmVwbGFjZSgnJCcsICdcXFxcJCcpO1xuICAvLyBpbml0aWFsaXppbmcgZGVmYXVsdHNcbiAgXy5kZWZhdWx0cyhzdGFydEFwcE9wdGlvbnMsIHtcbiAgICB3YWl0UGtnOiBzdGFydEFwcE9wdGlvbnMucGtnLFxuICAgIHdhaXRGb3JMYXVuY2g6IHRydWUsXG4gICAgd2FpdEFjdGl2aXR5OiBmYWxzZSxcbiAgICByZXRyeTogdHJ1ZSxcbiAgICBzdG9wQXBwOiB0cnVlXG4gIH0pO1xuICAvLyBwcmV2ZW50aW5nIG51bGwgd2FpdHBrZ1xuICBzdGFydEFwcE9wdGlvbnMud2FpdFBrZyA9IHN0YXJ0QXBwT3B0aW9ucy53YWl0UGtnIHx8IHN0YXJ0QXBwT3B0aW9ucy5wa2c7XG5cbiAgY29uc3QgYXBpTGV2ZWwgPSBhd2FpdCB0aGlzLmdldEFwaUxldmVsKCk7XG4gIGNvbnN0IGNtZCA9IGJ1aWxkU3RhcnRDbWQoc3RhcnRBcHBPcHRpb25zLCBhcGlMZXZlbCk7XG4gIHRyeSB7XG4gICAgY29uc3Qgc2hlbGxPcHRzID0ge307XG4gICAgaWYgKF8uaXNJbnRlZ2VyKHN0YXJ0QXBwT3B0aW9ucy53YWl0RHVyYXRpb24pICYmIHN0YXJ0QXBwT3B0aW9ucy53YWl0RHVyYXRpb24gPiAyMDAwMCkge1xuICAgICAgc2hlbGxPcHRzLnRpbWVvdXQgPSBzdGFydEFwcE9wdGlvbnMud2FpdER1cmF0aW9uO1xuICAgIH1cbiAgICBjb25zdCBzdGRvdXQgPSBhd2FpdCB0aGlzLnNoZWxsKGNtZCwgc2hlbGxPcHRzKTtcbiAgICBpZiAoc3Rkb3V0LmluY2x1ZGVzKCdFcnJvcjogQWN0aXZpdHkgY2xhc3MnKSAmJiBzdGRvdXQuaW5jbHVkZXMoJ2RvZXMgbm90IGV4aXN0JykpIHtcbiAgICAgIGlmIChzdGFydEFwcE9wdGlvbnMucmV0cnkgJiYgIXN0YXJ0QXBwT3B0aW9ucy5hY3Rpdml0eS5zdGFydHNXaXRoKCcuJykpIHtcbiAgICAgICAgbG9nLmRlYnVnKGBXZSB0cmllZCB0byBzdGFydCBhbiBhY3Rpdml0eSB0aGF0IGRvZXNuJ3QgZXhpc3QsIGAgK1xuICAgICAgICAgICAgICAgICAgYHJldHJ5aW5nIHdpdGggJy4ke3N0YXJ0QXBwT3B0aW9ucy5hY3Rpdml0eX0nIGFjdGl2aXR5IG5hbWVgKTtcbiAgICAgICAgc3RhcnRBcHBPcHRpb25zLmFjdGl2aXR5ID0gYC4ke3N0YXJ0QXBwT3B0aW9ucy5hY3Rpdml0eX1gO1xuICAgICAgICBzdGFydEFwcE9wdGlvbnMucmV0cnkgPSBmYWxzZTtcbiAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuc3RhcnRBcHAoc3RhcnRBcHBPcHRpb25zKTtcbiAgICAgIH1cbiAgICAgIHRocm93IG5ldyBFcnJvcihgQWN0aXZpdHkgbmFtZSAnJHtzdGFydEFwcE9wdGlvbnMuYWN0aXZpdHl9JyB1c2VkIHRvIHN0YXJ0IHRoZSBhcHAgZG9lc24ndCBgICtcbiAgICAgICAgICAgICAgICAgICAgICBgZXhpc3Qgb3IgY2Fubm90IGJlIGxhdW5jaGVkISBNYWtlIHN1cmUgaXQgZXhpc3RzIGFuZCBpcyBhIGxhdW5jaGFibGUgYWN0aXZpdHlgKTtcbiAgICB9IGVsc2UgaWYgKHN0ZG91dC5pbmNsdWRlcygnamF2YS5sYW5nLlNlY3VyaXR5RXhjZXB0aW9uJykpIHtcbiAgICAgIC8vIGlmIHRoZSBhcHAgaXMgZGlzYWJsZWQgb24gYSByZWFsIGRldmljZSBpdCB3aWxsIHRocm93IGEgc2VjdXJpdHkgZXhjZXB0aW9uXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFRoZSBwZXJtaXNzaW9uIHRvIHN0YXJ0ICcke3N0YXJ0QXBwT3B0aW9ucy5hY3Rpdml0eX0nIGFjdGl2aXR5IGhhcyBiZWVuIGRlbmllZC5gICtcbiAgICAgICAgICAgICAgICAgICAgICBgTWFrZSBzdXJlIHRoZSBhY3Rpdml0eS9wYWNrYWdlIG5hbWVzIGFyZSBjb3JyZWN0LmApO1xuICAgIH1cbiAgICBpZiAoc3RhcnRBcHBPcHRpb25zLndhaXRBY3Rpdml0eSkge1xuICAgICAgYXdhaXQgdGhpcy53YWl0Rm9yQWN0aXZpdHkoc3RhcnRBcHBPcHRpb25zLndhaXRQa2csIHN0YXJ0QXBwT3B0aW9ucy53YWl0QWN0aXZpdHksIHN0YXJ0QXBwT3B0aW9ucy53YWl0RHVyYXRpb24pO1xuICAgIH1cbiAgICByZXR1cm4gc3Rkb3V0O1xuICB9IGNhdGNoIChlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBDYW5ub3Qgc3RhcnQgdGhlICcke3N0YXJ0QXBwT3B0aW9ucy5wa2d9JyBhcHBsaWNhdGlvbi4gYCArXG4gICAgICBgVmlzaXQgJHtBQ1RJVklUSUVTX1RST1VCTEVTSE9PVElOR19MSU5LfSBmb3IgdHJvdWJsZXNob290aW5nLiBgICtcbiAgICAgIGBPcmlnaW5hbCBlcnJvcjogJHtlLm1lc3NhZ2V9YCk7XG4gIH1cbn07XG5cbi8qKlxuICogSGVscGVyIG1ldGhvZCB0byBjYWxsIGBhZGIgZHVtcHN5cyB3aW5kb3cgd2luZG93cy9kaXNwbGF5c2BcbiAqL1xuYXBrVXRpbHNNZXRob2RzLmR1bXBXaW5kb3dzID0gYXN5bmMgZnVuY3Rpb24gZHVtcFdpbmRvd3MgKCkge1xuICBjb25zdCBhcGlMZXZlbCA9IGF3YWl0IHRoaXMuZ2V0QXBpTGV2ZWwoKTtcblxuICAvLyBXaXRoIHZlcnNpb24gMjksIEFuZHJvaWQgY2hhbmdlZCB0aGUgZHVtcHN5cyBzeW50YXhcbiAgY29uc3QgZHVtcHN5c0FyZyA9IGFwaUxldmVsID49IDI5ID8gJ2Rpc3BsYXlzJyA6ICd3aW5kb3dzJztcbiAgY29uc3QgY21kID0gWydkdW1wc3lzJywgJ3dpbmRvdycsIGR1bXBzeXNBcmddO1xuXG4gIHJldHVybiBhd2FpdCB0aGlzLnNoZWxsKGNtZCk7XG59O1xuXG4vKipcbiAqIEB0eXBlZGVmIHtPYmplY3R9IFBhY2thZ2VBY3Rpdml0eUluZm9cbiAqIEBwcm9wZXJ0eSB7P3N0cmluZ30gYXBwUGFja2FnZSAtIFRoZSBuYW1lIG9mIGFwcGxpY2F0aW9uIHBhY2thZ2UsXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgZXhhbXBsZSAnY29tLmFjbWUuYXBwJy5cbiAqIEBwcm9wZXJ0eSB7P3N0cmluZ30gYXBwQWN0aXZpdHkgLSBUaGUgbmFtZSBvZiBtYWluIGFwcGxpY2F0aW9uIGFjdGl2aXR5LlxuICovXG5cbi8qKlxuICogR2V0IHRoZSBuYW1lIG9mIGN1cnJlbnRseSBmb2N1c2VkIHBhY2thZ2UgYW5kIGFjdGl2aXR5LlxuICpcbiAqIEByZXR1cm4ge1BhY2thZ2VBY3Rpdml0eUluZm99IFRoZSBtYXBwaW5nLCB3aGVyZSBwcm9wZXJ0eSBuYW1lcyBhcmUgJ2FwcFBhY2thZ2UnIGFuZCAnYXBwQWN0aXZpdHknLlxuICogQHRocm93cyB7RXJyb3J9IElmIHRoZXJlIGlzIGFuIGVycm9yIHdoaWxlIHBhcnNpbmcgdGhlIGRhdGEuXG4gKi9cbmFwa1V0aWxzTWV0aG9kcy5nZXRGb2N1c2VkUGFja2FnZUFuZEFjdGl2aXR5ID0gYXN5bmMgZnVuY3Rpb24gZ2V0Rm9jdXNlZFBhY2thZ2VBbmRBY3Rpdml0eSAoKSB7XG4gIGxvZy5kZWJ1ZygnR2V0dGluZyBmb2N1c2VkIHBhY2thZ2UgYW5kIGFjdGl2aXR5Jyk7XG4gIGNvbnN0IG51bGxGb2N1c2VkQXBwUmUgPSBuZXcgUmVnRXhwKC9eXFxzKm1Gb2N1c2VkQXBwPW51bGwvLCAnbScpO1xuICAvLyBodHRwczovL3JlZ2V4MTAxLmNvbS9yL3haOHZGNy8xXG4gIGNvbnN0IGZvY3VzZWRBcHBSZSA9IG5ldyBSZWdFeHAoJ15cXFxccyptRm9jdXNlZEFwcC4rUmVjb3JkXFxcXHsuKlxcXFxzKFteXFxcXHNcXFxcL1xcXFx9XSspJyArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1xcXFwvKFteXFxcXHNcXFxcL1xcXFx9XFxcXCxdKylcXFxcLD8oXFxcXHNbXlxcXFxzXFxcXC9cXFxcfV0rKSpcXFxcfScsICdtJyk7XG4gIGNvbnN0IG51bGxDdXJyZW50Rm9jdXNSZSA9IG5ldyBSZWdFeHAoL15cXHMqbUN1cnJlbnRGb2N1cz1udWxsLywgJ20nKTtcbiAgY29uc3QgY3VycmVudEZvY3VzQXBwUmUgPSBuZXcgUmVnRXhwKCdeXFxcXHMqbUN1cnJlbnRGb2N1cy4rXFxcXHsuK1xcXFxzKFteXFxcXHNcXFxcL10rKVxcXFwvKFteXFxcXHNdKylcXFxcYicsICdtJyk7XG5cbiAgdHJ5IHtcbiAgICBjb25zdCBzdGRvdXQgPSBhd2FpdCB0aGlzLmR1bXBXaW5kb3dzKCk7XG4gICAgLy8gVGhlIG9yZGVyIG1hdHRlcnMgaGVyZVxuICAgIGZvciAoY29uc3QgcGF0dGVybiBvZiBbZm9jdXNlZEFwcFJlLCBjdXJyZW50Rm9jdXNBcHBSZV0pIHtcbiAgICAgIGNvbnN0IG1hdGNoID0gcGF0dGVybi5leGVjKHN0ZG91dCk7XG4gICAgICBpZiAobWF0Y2gpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBhcHBQYWNrYWdlOiBtYXRjaFsxXS50cmltKCksXG4gICAgICAgICAgYXBwQWN0aXZpdHk6IG1hdGNoWzJdLnRyaW0oKVxuICAgICAgICB9O1xuICAgICAgfVxuICAgIH1cblxuICAgIGZvciAoY29uc3QgcGF0dGVybiBvZiBbbnVsbEZvY3VzZWRBcHBSZSwgbnVsbEN1cnJlbnRGb2N1c1JlXSkge1xuICAgICAgaWYgKHBhdHRlcm4uZXhlYyhzdGRvdXQpKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgYXBwUGFja2FnZTogbnVsbCxcbiAgICAgICAgICBhcHBBY3Rpdml0eTogbnVsbFxuICAgICAgICB9O1xuICAgICAgfVxuICAgIH1cblxuICAgIHRocm93IG5ldyBFcnJvcignQ291bGQgbm90IHBhcnNlIGFjdGl2aXR5IGZyb20gZHVtcHN5cycpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBDb3VsZCBub3QgZ2V0IGZvY3VzUGFja2FnZUFuZEFjdGl2aXR5LiBPcmlnaW5hbCBlcnJvcjogJHtlLm1lc3NhZ2V9YCk7XG4gIH1cbn07XG5cbi8qKlxuICogV2FpdCBmb3IgdGhlIGdpdmVuIGFjdGl2aXR5IHRvIGJlIGZvY3VzZWQvbm9uLWZvY3VzZWQuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHBrZyAtIFRoZSBuYW1lIG9mIHRoZSBwYWNrYWdlIHRvIHdhaXQgZm9yLlxuICogQHBhcmFtIHtzdHJpbmd9IGFjdGl2aXR5IC0gVGhlIG5hbWUgb2YgdGhlIGFjdGl2aXR5LCBiZWxvbmdpbmcgdG8gdGhhdCBwYWNrYWdlLFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG8gd2FpdCBmb3IuXG4gKiBAcGFyYW0ge2Jvb2xlYW59IHdhaXRGb3JTdG9wIC0gV2hldGhlciB0byB3YWl0IHVudGlsIHRoZSBhY3Rpdml0eSBpcyBmb2N1c2VkICh0cnVlKVxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yIGlzIG5vdCBmb2N1c2VkIChmYWxzZSkuXG4gKiBAcGFyYW0ge251bWJlcn0gd2FpdE1zIFsyMDAwMF0gLSBOdW1iZXIgb2YgbWlsbGlzZWNvbmRzIHRvIHdhaXQgYmVmb3JlIHRpbWVvdXQgb2NjdXJzLlxuICogQHRocm93cyB7ZXJyb3J9IElmIHRpbWVvdXQgaGFwcGVucy5cbiAqL1xuYXBrVXRpbHNNZXRob2RzLndhaXRGb3JBY3Rpdml0eU9yTm90ID0gYXN5bmMgZnVuY3Rpb24gd2FpdEZvckFjdGl2aXR5T3JOb3QgKHBrZywgYWN0aXZpdHksIHdhaXRGb3JTdG9wLCB3YWl0TXMgPSAyMDAwMCkge1xuICBpZiAoIXBrZyB8fCAhYWN0aXZpdHkpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ1BhY2thZ2UgYW5kIGFjdGl2aXR5IHJlcXVpcmVkLicpO1xuICB9XG4gIGxvZy5kZWJ1ZyhgV2FpdGluZyB1cCB0byAke3dhaXRNc31tcyBmb3IgYWN0aXZpdHkgbWF0Y2hpbmcgcGtnOiAnJHtwa2d9JyBhbmQgYCArXG4gICAgICAgICAgICBgYWN0aXZpdHk6ICcke2FjdGl2aXR5fScgdG8ke3dhaXRGb3JTdG9wID8gJyBub3QnIDogJyd9IGJlIGZvY3VzZWRgKTtcblxuICBjb25zdCBzcGxpdE5hbWVzID0gKG5hbWVzKSA9PiBuYW1lcy5zcGxpdCgnLCcpLm1hcCgobmFtZSkgPT4gbmFtZS50cmltKCkpO1xuXG4gIGNvbnN0IGFsbFBhY2thZ2VzID0gc3BsaXROYW1lcyhwa2cpO1xuICBjb25zdCBhbGxBY3Rpdml0aWVzID0gc3BsaXROYW1lcyhhY3Rpdml0eSk7XG5cbiAgbGV0IHBvc3NpYmxlQWN0aXZpdHlOYW1lcyA9IFtdO1xuICBmb3IgKGxldCBvbmVBY3Rpdml0eSBvZiBhbGxBY3Rpdml0aWVzKSB7XG4gICAgaWYgKG9uZUFjdGl2aXR5LnN0YXJ0c1dpdGgoJy4nKSkge1xuICAgICAgLy8gYWRkIHRoZSBwYWNrYWdlIG5hbWUgaWYgYWN0aXZpdHkgaXMgbm90IGZ1bGwgcXVhbGlmaWVkXG4gICAgICBmb3IgKGxldCBjdXJyZW50UGtnIG9mIGFsbFBhY2thZ2VzKSB7XG4gICAgICAgIHBvc3NpYmxlQWN0aXZpdHlOYW1lcy5wdXNoKGAke2N1cnJlbnRQa2d9JHtvbmVBY3Rpdml0eX1gLnJlcGxhY2UoL1xcLisvZywgJy4nKSk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIGFjY2VwdCBmdWxseSBxdWFsaWZpZWQgYWN0aXZpdHkgbmFtZS5cbiAgICAgIHBvc3NpYmxlQWN0aXZpdHlOYW1lcy5wdXNoKG9uZUFjdGl2aXR5KTtcbiAgICAgIHBvc3NpYmxlQWN0aXZpdHlOYW1lcy5wdXNoKGAke3BrZ30uJHtvbmVBY3Rpdml0eX1gKTtcbiAgICB9XG4gIH1cbiAgbG9nLmRlYnVnKGBQb3NzaWJsZSBhY3Rpdml0aWVzLCB0byBiZSBjaGVja2VkOiAke3Bvc3NpYmxlQWN0aXZpdHlOYW1lcy5tYXAoKG5hbWUpID0+IGAnJHtuYW1lfSdgKS5qb2luKCcsICcpfWApO1xuXG4gIGxldCBwb3NzaWJsZUFjdGl2aXR5UGF0dGVybnMgPSBwb3NzaWJsZUFjdGl2aXR5TmFtZXMubWFwKChwb3NzaWJsZUFjdGl2aXR5TmFtZSkgPT5cbiAgICBuZXcgUmVnRXhwKGBeJHtwb3NzaWJsZUFjdGl2aXR5TmFtZS5yZXBsYWNlKC9cXC4vZywgJ1xcXFwuJykucmVwbGFjZSgvXFwqL2csICcuKj8nKS5yZXBsYWNlKC9cXCQvZywgJ1xcXFwkJyl9JGApXG4gICk7XG5cbiAgLy8gZmlndXJlIG91dCB0aGUgbnVtYmVyIG9mIHJldHJpZXMuIFRyeSBvbmNlIGlmIHdhaXRNcyBpcyBsZXNzIHRoYXQgNzUwXG4gIC8vIDMwIHRpbWVzIGlmIHBhcnNpbmcgaXMgbm90IHBvc3NpYmxlXG4gIGxldCByZXRyaWVzID0gcGFyc2VJbnQod2FpdE1zIC8gNzUwLCAxMCkgfHwgMTtcbiAgcmV0cmllcyA9IGlzTmFOKHJldHJpZXMpID8gMzAgOiByZXRyaWVzO1xuICBhd2FpdCByZXRyeUludGVydmFsKHJldHJpZXMsIDc1MCwgYXN5bmMgKCkgPT4ge1xuICAgIGxldCB7YXBwUGFja2FnZSwgYXBwQWN0aXZpdHl9ID0gYXdhaXQgdGhpcy5nZXRGb2N1c2VkUGFja2FnZUFuZEFjdGl2aXR5KCk7XG4gICAgaWYgKGFwcEFjdGl2aXR5ICYmIGFwcFBhY2thZ2UpIHtcbiAgICAgIGxldCBmdWxseVF1YWxpZmllZEFjdGl2aXR5ID0gYXBwQWN0aXZpdHkuc3RhcnRzV2l0aCgnLicpID8gYCR7YXBwUGFja2FnZX0ke2FwcEFjdGl2aXR5fWAgOiBhcHBBY3Rpdml0eTtcbiAgICAgIGxvZy5kZWJ1ZyhgRm91bmQgcGFja2FnZTogJyR7YXBwUGFja2FnZX0nIGFuZCBmdWxseSBxdWFsaWZpZWQgYWN0aXZpdHkgbmFtZSA6ICcke2Z1bGx5UXVhbGlmaWVkQWN0aXZpdHl9J2ApO1xuICAgICAgbGV0IGZvdW5kQWN0ID0gKF8uaW5jbHVkZXMoYWxsUGFja2FnZXMsIGFwcFBhY2thZ2UpICYmXG4gICAgICAgICAgICAgICAgICAgICAgXy5maW5kSW5kZXgocG9zc2libGVBY3Rpdml0eVBhdHRlcm5zLCAocG9zc2libGVQYXR0ZXJuKSA9PiBwb3NzaWJsZVBhdHRlcm4udGVzdChmdWxseVF1YWxpZmllZEFjdGl2aXR5KSkgIT09IC0xKTtcbiAgICAgIGlmICgoIXdhaXRGb3JTdG9wICYmIGZvdW5kQWN0KSB8fCAod2FpdEZvclN0b3AgJiYgIWZvdW5kQWN0KSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgfVxuICAgIGxvZy5kZWJ1ZygnSW5jb3JyZWN0IHBhY2thZ2UgYW5kIGFjdGl2aXR5LiBSZXRyeWluZy4nKTtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYCR7cG9zc2libGVBY3Rpdml0eU5hbWVzLm1hcCgobmFtZSkgPT4gYCcke25hbWV9J2ApLmpvaW4oJyBvciAnKX0gbmV2ZXIgJHt3YWl0Rm9yU3RvcCA/ICdzdG9wcGVkJyA6ICdzdGFydGVkJ30uIGAgK1xuICAgICAgYFZpc2l0ICR7QUNUSVZJVElFU19UUk9VQkxFU0hPT1RJTkdfTElOS30gZm9yIHRyb3VibGVzaG9vdGluZ2ApO1xuICB9KTtcbn07XG5cbi8qKlxuICogV2FpdCBmb3IgdGhlIGdpdmVuIGFjdGl2aXR5IHRvIGJlIGZvY3VzZWRcbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gcGtnIC0gVGhlIG5hbWUgb2YgdGhlIHBhY2thZ2UgdG8gd2FpdCBmb3IuXG4gKiBAcGFyYW0ge3N0cmluZ30gYWN0aXZpdHkgLSBUaGUgbmFtZSBvZiB0aGUgYWN0aXZpdHksIGJlbG9uZ2luZyB0byB0aGF0IHBhY2thZ2UsXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0byB3YWl0IGZvci5cbiAqIEBwYXJhbSB7bnVtYmVyfSB3YWl0TXMgWzIwMDAwXSAtIE51bWJlciBvZiBtaWxsaXNlY29uZHMgdG8gd2FpdCBiZWZvcmUgdGltZW91dCBvY2N1cnMuXG4gKiBAdGhyb3dzIHtlcnJvcn0gSWYgdGltZW91dCBoYXBwZW5zLlxuICovXG5hcGtVdGlsc01ldGhvZHMud2FpdEZvckFjdGl2aXR5ID0gYXN5bmMgZnVuY3Rpb24gd2FpdEZvckFjdGl2aXR5IChwa2csIGFjdCwgd2FpdE1zID0gMjAwMDApIHtcbiAgYXdhaXQgdGhpcy53YWl0Rm9yQWN0aXZpdHlPck5vdChwa2csIGFjdCwgZmFsc2UsIHdhaXRNcyk7XG59O1xuXG4vKipcbiAqIFdhaXQgZm9yIHRoZSBnaXZlbiBhY3Rpdml0eSB0byBiZSBub24tZm9jdXNlZC5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gcGtnIC0gVGhlIG5hbWUgb2YgdGhlIHBhY2thZ2UgdG8gd2FpdCBmb3IuXG4gKiBAcGFyYW0ge3N0cmluZ30gYWN0aXZpdHkgLSBUaGUgbmFtZSBvZiB0aGUgYWN0aXZpdHksIGJlbG9uZ2luZyB0byB0aGF0IHBhY2thZ2UsXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0byB3YWl0IGZvci5cbiAqIEBwYXJhbSB7bnVtYmVyfSB3YWl0TXMgWzIwMDAwXSAtIE51bWJlciBvZiBtaWxsaXNlY29uZHMgdG8gd2FpdCBiZWZvcmUgdGltZW91dCBvY2N1cnMuXG4gKiBAdGhyb3dzIHtlcnJvcn0gSWYgdGltZW91dCBoYXBwZW5zLlxuICovXG5hcGtVdGlsc01ldGhvZHMud2FpdEZvck5vdEFjdGl2aXR5ID0gYXN5bmMgZnVuY3Rpb24gd2FpdEZvck5vdEFjdGl2aXR5IChwa2csIGFjdCwgd2FpdE1zID0gMjAwMDApIHtcbiAgYXdhaXQgdGhpcy53YWl0Rm9yQWN0aXZpdHlPck5vdChwa2csIGFjdCwgdHJ1ZSwgd2FpdE1zKTtcbn07XG5cbi8qKlxuICogQHR5cGVkZWYge09iamVjdH0gVW5pbnN0YWxsT3B0aW9uc1xuICogQHByb3BlcnR5IHtudW1iZXJ9IHRpbWVvdXQgW2FkYkV4ZWNUaW1lb3V0XSAtIFRoZSBjb3VudCBvZiBtaWxsaXNlY29uZHMgdG8gd2FpdCB1bnRpbCB0aGVcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHAgaXMgdW5pbnN0YWxsZWQuXG4gKiBAcHJvcGVydHkge2Jvb2xlYW59IGtlZXBEYXRhIFtmYWxzZV0gLSBTZXQgdG8gdHJ1ZSBpbiBvcmRlciB0byBrZWVwIHRoZVxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwbGljYXRpb24gZGF0YSBhbmQgY2FjaGUgZm9sZGVycyBhZnRlciB1bmluc3RhbGwuXG4gKi9cblxuLyoqXG4gKiBVbmluc3RhbGwgdGhlIGdpdmVuIHBhY2thZ2UgZnJvbSB0aGUgZGV2aWNlIHVuZGVyIHRlc3QuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHBrZyAtIFRoZSBuYW1lIG9mIHRoZSBwYWNrYWdlIHRvIGJlIHVuaW5zdGFsbGVkLlxuICogQHBhcmFtIHs/VW5pbnN0YWxsT3B0aW9uc30gb3B0aW9ucyAtIFRoZSBzZXQgb2YgdW5pbnN0YWxsIG9wdGlvbnMuXG4gKiBAcmV0dXJuIHtib29sZWFufSBUcnVlIGlmIHRoZSBwYWNrYWdlIHdhcyBmb3VuZCBvbiB0aGUgZGV2aWNlIGFuZFxuICogICAgICAgICAgICAgICAgICAgc3VjY2Vzc2Z1bGx5IHVuaW5zdGFsbGVkLlxuICovXG5hcGtVdGlsc01ldGhvZHMudW5pbnN0YWxsQXBrID0gYXN5bmMgZnVuY3Rpb24gdW5pbnN0YWxsQXBrIChwa2csIG9wdGlvbnMgPSB7fSkge1xuICBsb2cuZGVidWcoYFVuaW5zdGFsbGluZyAke3BrZ31gKTtcbiAgaWYgKCFhd2FpdCB0aGlzLmlzQXBwSW5zdGFsbGVkKHBrZykpIHtcbiAgICBsb2cuaW5mbyhgJHtwa2d9IHdhcyBub3QgdW5pbnN0YWxsZWQsIGJlY2F1c2UgaXQgd2FzIG5vdCBwcmVzZW50IG9uIHRoZSBkZXZpY2VgKTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBjb25zdCBjbWQgPSBbJ3VuaW5zdGFsbCddO1xuICBpZiAob3B0aW9ucy5rZWVwRGF0YSkge1xuICAgIGNtZC5wdXNoKCctaycpO1xuICB9XG4gIGNtZC5wdXNoKHBrZyk7XG5cbiAgbGV0IHN0ZG91dDtcbiAgdHJ5IHtcbiAgICBhd2FpdCB0aGlzLmZvcmNlU3RvcChwa2cpO1xuICAgIHN0ZG91dCA9IChhd2FpdCB0aGlzLmFkYkV4ZWMoY21kLCB7dGltZW91dDogb3B0aW9ucy50aW1lb3V0fSkpLnRyaW0oKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgVW5hYmxlIHRvIHVuaW5zdGFsbCBBUEsuIE9yaWdpbmFsIGVycm9yOiAke2UubWVzc2FnZX1gKTtcbiAgfVxuICBsb2cuZGVidWcoYCdhZGIgJHtjbWQuam9pbignICcpfScgY29tbWFuZCBvdXRwdXQ6ICR7c3Rkb3V0fWApO1xuICBpZiAoc3Rkb3V0LmluY2x1ZGVzKCdTdWNjZXNzJykpIHtcbiAgICBsb2cuaW5mbyhgJHtwa2d9IHdhcyBzdWNjZXNzZnVsbHkgdW5pbnN0YWxsZWRgKTtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICBsb2cuaW5mbyhgJHtwa2d9IHdhcyBub3QgdW5pbnN0YWxsZWRgKTtcbiAgcmV0dXJuIGZhbHNlO1xufTtcblxuLyoqXG4gKiBJbnN0YWxsIHRoZSBwYWNrYWdlIGFmdGVyIGl0IHdhcyBwdXNoZWQgdG8gdGhlIGRldmljZSB1bmRlciB0ZXN0LlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBhcGtQYXRoT25EZXZpY2UgLSBUaGUgZnVsbCBwYXRoIHRvIHRoZSBwYWNrYWdlIG9uIHRoZSBkZXZpY2UgZmlsZSBzeXN0ZW0uXG4gKiBAcGFyYW0ge29iamVjdH0gb3B0cyBbe31dIC0gQWRkaXRpb25hbCBleGVjIG9wdGlvbnMuIFNlZSB7QGxpbmsgaHR0cHM6Ly9naXRodWIuY29tL2FwcGl1bS9ub2RlLXRlZW5fcHJvY2Vzc31cbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgbW9yZSBkZXRhaWxzIG9uIHRoaXMgcGFyYW1ldGVyLlxuICogQHRocm93cyB7ZXJyb3J9IElmIHRoZXJlIHdhcyBhIGZhaWx1cmUgZHVyaW5nIGFwcGxpY2F0aW9uIGluc3RhbGwuXG4gKi9cbmFwa1V0aWxzTWV0aG9kcy5pbnN0YWxsRnJvbURldmljZVBhdGggPSBhc3luYyBmdW5jdGlvbiBpbnN0YWxsRnJvbURldmljZVBhdGggKGFwa1BhdGhPbkRldmljZSwgb3B0cyA9IHt9KSB7XG4gIGxldCBzdGRvdXQgPSBhd2FpdCB0aGlzLnNoZWxsKFsncG0nLCAnaW5zdGFsbCcsICctcicsIGFwa1BhdGhPbkRldmljZV0sIG9wdHMpO1xuICBpZiAoc3Rkb3V0LmluZGV4T2YoJ0ZhaWx1cmUnKSAhPT0gLTEpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYFJlbW90ZSBpbnN0YWxsIGZhaWxlZDogJHtzdGRvdXR9YCk7XG4gIH1cbn07XG5cbi8qKlxuICogQHR5cGVkZWYge09iamVjdH0gQ2FjaGluZ09wdGlvbnNcbiAqIEBwcm9wZXJ0eSB7P251bWJlcn0gdGltZW91dCBbYWRiRXhlY1RpbWVvdXRdIC0gVGhlIGNvdW50IG9mIG1pbGxpc2Vjb25kcyB0byB3YWl0IHVudGlsIHRoZVxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHAgaXMgdXBsb2FkZWQgdG8gdGhlIHJlbW90ZSBsb2NhdGlvbi5cbiAqL1xuXG4vKipcbiAqIENhY2hlcyB0aGUgZ2l2ZW4gQVBLIGF0IGEgcmVtb3RlIGxvY2F0aW9uIHRvIHNwZWVkIHVwIGZ1cnRoZXIgQVBLIGRlcGxveW1lbnRzLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBhcGtQYXRoIC0gRnVsbCBwYXRoIHRvIHRoZSBhcGsgb24gdGhlIGxvY2FsIEZTXG4gKiBAcGFyYW0gez9DYWNoaW5nT3B0aW9uc30gb3B0aW9ucyAtIENhY2hpbmcgb3B0aW9uc1xuICogQHJldHVybnMge3N0cmluZ30gLSBGdWxsIHBhdGggdG8gdGhlIGNhY2hlZCBhcGsgb24gdGhlIHJlbW90ZSBmaWxlIHN5c3RlbVxuICovXG5hcGtVdGlsc01ldGhvZHMuY2FjaGVBcGsgPSBhc3luYyBmdW5jdGlvbiBjYWNoZUFwayAoYXBrUGF0aCwgb3B0aW9ucyA9IHt9KSB7XG4gIGNvbnN0IGFwcEhhc2ggPSBhd2FpdCBmcy5oYXNoKGFwa1BhdGgpO1xuICBjb25zdCByZW1vdGVQYXRoID0gcGF0aC5wb3NpeC5qb2luKFJFTU9URV9DQUNIRV9ST09ULCBgJHthcHBIYXNofS5hcGtgKTtcbiAgY29uc3QgcmVtb3RlQ2FjaGVkRmlsZXMgPSBbXTtcbiAgLy8gR2V0IGN1cnJlbnQgY29udGVudHMgb2YgdGhlIHJlbW90ZSBjYWNoZSBvciBjcmVhdGUgaXQgZm9yIHRoZSBmaXJzdCB0aW1lXG4gIHRyeSB7XG4gICAgY29uc3QgZXJyb3JNYXJrZXIgPSAnX0VSUk9SXyc7XG4gICAgbGV0IGxzT3V0cHV0ID0gbnVsbDtcbiAgICBpZiAodGhpcy5fYXJlRXh0ZW5kZWRMc09wdGlvbnNTdXBwb3J0ZWQgPT09IHRydWUgfHwgIV8uaXNCb29sZWFuKHRoaXMuX2FyZUV4dGVuZGVkTHNPcHRpb25zU3VwcG9ydGVkKSkge1xuICAgICAgbHNPdXRwdXQgPSBhd2FpdCB0aGlzLnNoZWxsKFtgbHMgLXQgLTEgJHtSRU1PVEVfQ0FDSEVfUk9PVH0gMj4mMSB8fCBlY2hvICR7ZXJyb3JNYXJrZXJ9YF0pO1xuICAgIH1cbiAgICBpZiAoIV8uaXNTdHJpbmcobHNPdXRwdXQpIHx8IChsc091dHB1dC5pbmNsdWRlcyhlcnJvck1hcmtlcikgJiYgIWxzT3V0cHV0LmluY2x1ZGVzKFJFTU9URV9DQUNIRV9ST09UKSkpIHtcbiAgICAgIGlmICghXy5pc0Jvb2xlYW4odGhpcy5fYXJlRXh0ZW5kZWRMc09wdGlvbnNTdXBwb3J0ZWQpKSB7XG4gICAgICAgIGxvZy5kZWJ1ZygnVGhlIGN1cnJlbnQgQW5kcm9pZCBBUEkgZG9lcyBub3Qgc3VwcG9ydCBleHRlbmRlZCBscyBvcHRpb25zLiAnICtcbiAgICAgICAgICAnRGVmYXVsdGluZyB0byBuby1vcHRpb25zIGNhbGwnKTtcbiAgICAgIH1cbiAgICAgIGxzT3V0cHV0ID0gYXdhaXQgdGhpcy5zaGVsbChbYGxzICR7UkVNT1RFX0NBQ0hFX1JPT1R9IDI+JjEgfHwgZWNobyAke2Vycm9yTWFya2VyfWBdKTtcbiAgICAgIHRoaXMuX2FyZUV4dGVuZGVkTHNPcHRpb25zU3VwcG9ydGVkID0gZmFsc2U7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX2FyZUV4dGVuZGVkTHNPcHRpb25zU3VwcG9ydGVkID0gdHJ1ZTtcbiAgICB9XG4gICAgaWYgKGxzT3V0cHV0LmluY2x1ZGVzKGVycm9yTWFya2VyKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGxzT3V0cHV0LnN1YnN0cmluZygwLCBsc091dHB1dC5pbmRleE9mKGVycm9yTWFya2VyKSkpO1xuICAgIH1cbiAgICByZW1vdGVDYWNoZWRGaWxlcy5wdXNoKC4uLihcbiAgICAgIGxzT3V0cHV0LnNwbGl0KCdcXG4nKVxuICAgICAgICAubWFwKCh4KSA9PiB4LnRyaW0oKSlcbiAgICAgICAgLmZpbHRlcihCb29sZWFuKVxuICAgICkpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgbG9nLmRlYnVnKGBHb3QgYW4gZXJyb3IgJyR7ZS5tZXNzYWdlLnRyaW0oKX0nIHdoaWxlIGdldHRpbmcgdGhlIGxpc3Qgb2YgZmlsZXMgaW4gdGhlIGNhY2hlLiBgICtcbiAgICAgIGBBc3N1bWluZyB0aGUgY2FjaGUgZG9lcyBub3QgZXhpc3QgeWV0YCk7XG4gICAgYXdhaXQgdGhpcy5zaGVsbChbJ21rZGlyJywgJy1wJywgUkVNT1RFX0NBQ0hFX1JPT1RdKTtcbiAgfVxuICBsb2cuZGVidWcoYFRoZSBjb3VudCBvZiBhcHBsaWNhdGlvbnMgaW4gdGhlIGNhY2hlOiAke3JlbW90ZUNhY2hlZEZpbGVzLmxlbmd0aH1gKTtcbiAgY29uc3QgdG9IYXNoID0gKHJlbW90ZVBhdGgpID0+IHBhdGgucG9zaXgucGFyc2UocmVtb3RlUGF0aCkubmFtZTtcbiAgLy8gUHVzaCB0aGUgYXBrIHRvIHRoZSByZW1vdGUgY2FjaGUgaWYgbmVlZGVkXG4gIGlmIChyZW1vdGVDYWNoZWRGaWxlcy5maW5kKCh4KSA9PiB0b0hhc2goeCkgPT09IGFwcEhhc2gpKSB7XG4gICAgbG9nLmluZm8oYFRoZSBhcHBsaWNhdGlvbiBhdCAnJHthcGtQYXRofScgaXMgYWxyZWFkeSBjYWNoZWQgdG8gJyR7cmVtb3RlUGF0aH0nYCk7XG4gIH0gZWxzZSB7XG4gICAgbG9nLmluZm8oYENhY2hpbmcgdGhlIGFwcGxpY2F0aW9uIGF0ICcke2Fwa1BhdGh9JyB0byAnJHtyZW1vdGVQYXRofSdgKTtcbiAgICBjb25zdCBzdGFydGVkID0gcHJvY2Vzcy5ocnRpbWUoKTtcbiAgICBhd2FpdCB0aGlzLnB1c2goYXBrUGF0aCwgcmVtb3RlUGF0aCwge3RpbWVvdXQ6IG9wdGlvbnMudGltZW91dH0pO1xuICAgIGNvbnN0IFtzZWNvbmRzLCBuYW5vc10gPSBwcm9jZXNzLmhydGltZShzdGFydGVkKTtcbiAgICBjb25zdCB7c2l6ZX0gPSBhd2FpdCBmcy5zdGF0KGFwa1BhdGgpO1xuICAgIGxvZy5pbmZvKGBUaGUgdXBsb2FkIG9mICcke3BhdGguYmFzZW5hbWUoYXBrUGF0aCl9JyAoJHt1dGlsLnRvUmVhZGFibGVTaXplU3RyaW5nKHNpemUpfSkgYCArXG4gICAgICBgdG9vayAkeyhzZWNvbmRzICsgbmFub3MgLyAxZTkpLnRvRml4ZWQoMyl9c2ApO1xuICB9XG4gIGlmICghdGhpcy5yZW1vdGVBcHBzQ2FjaGUpIHtcbiAgICB0aGlzLnJlbW90ZUFwcHNDYWNoZSA9IG5ldyBMUlUoe1xuICAgICAgbWF4OiB0aGlzLnJlbW90ZUFwcHNDYWNoZUxpbWl0LFxuICAgIH0pO1xuICB9XG4gIC8vIENsZWFudXAgdGhlIGludmFsaWQgZW50cmllcyBmcm9tIHRoZSBjYWNoZVxuICBfLmRpZmZlcmVuY2UodGhpcy5yZW1vdGVBcHBzQ2FjaGUua2V5cygpLCByZW1vdGVDYWNoZWRGaWxlcy5tYXAodG9IYXNoKSlcbiAgICAuZm9yRWFjaCgoaGFzaCkgPT4gdGhpcy5yZW1vdGVBcHBzQ2FjaGUuZGVsKGhhc2gpKTtcbiAgLy8gQnVtcCB0aGUgY2FjaGUgcmVjb3JkIGZvciB0aGUgcmVjZW50bHkgY2FjaGVkIGl0ZW1cbiAgdGhpcy5yZW1vdGVBcHBzQ2FjaGUuc2V0KGFwcEhhc2gsIHJlbW90ZVBhdGgpO1xuICAvLyBJZiB0aGUgcmVtb3RlIGNhY2hlIGV4Y2VlZHMgdGhpcy5yZW1vdGVBcHBzQ2FjaGVMaW1pdCwgcmVtb3ZlIHRoZSBsZWFzdCByZWNlbnRseSB1c2VkIGVudHJpZXNcbiAgY29uc3QgZW50cmllc1RvQ2xlYW51cCA9IHJlbW90ZUNhY2hlZEZpbGVzXG4gICAgLm1hcCgoeCkgPT4gcGF0aC5wb3NpeC5qb2luKFJFTU9URV9DQUNIRV9ST09ULCB4KSlcbiAgICAuZmlsdGVyKCh4KSA9PiAhdGhpcy5yZW1vdGVBcHBzQ2FjaGUuaGFzKHRvSGFzaCh4KSkpXG4gICAgLnNsaWNlKHRoaXMucmVtb3RlQXBwc0NhY2hlTGltaXQgLSB0aGlzLnJlbW90ZUFwcHNDYWNoZS5rZXlzKCkubGVuZ3RoKTtcbiAgaWYgKCFfLmlzRW1wdHkoZW50cmllc1RvQ2xlYW51cCkpIHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5zaGVsbChbJ3JtJywgJy1mJywgLi4uZW50cmllc1RvQ2xlYW51cF0pO1xuICAgICAgbG9nLmRlYnVnKGBEZWxldGVkICR7ZW50cmllc1RvQ2xlYW51cC5sZW5ndGh9IGV4cGlyZWQgYXBwbGljYXRpb24gY2FjaGUgZW50cmllc2ApO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGxvZy53YXJuKGBDYW5ub3QgZGVsZXRlICR7ZW50cmllc1RvQ2xlYW51cC5sZW5ndGh9IGV4cGlyZWQgYXBwbGljYXRpb24gY2FjaGUgZW50cmllcy4gYCArXG4gICAgICAgIGBPcmlnaW5hbCBlcnJvcjogJHtlLm1lc3NhZ2V9YCk7XG4gICAgfVxuICB9XG4gIHJldHVybiByZW1vdGVQYXRoO1xufTtcblxuLyoqXG4gKiBAdHlwZWRlZiB7T2JqZWN0fSBJbnN0YWxsT3B0aW9uc1xuICogQHByb3BlcnR5IHtudW1iZXJ9IHRpbWVvdXQgWzYwMDAwXSAtIFRoZSBjb3VudCBvZiBtaWxsaXNlY29uZHMgdG8gd2FpdCB1bnRpbCB0aGVcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHAgaXMgaW5zdGFsbGVkLlxuICogQHByb3BlcnR5IHtzdHJpbmd9IHRpbWVvdXRDYXBOYW1lIFthbmRyb2lkSW5zdGFsbFRpbWVvdXRdIC0gVGhlIHRpbWVvdXQgb3B0aW9uIG5hbWVcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJzIGNhbiBpbmNyZWFzZSB0aGUgdGltZW91dC5cbiAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gYWxsb3dUZXN0UGFja2FnZXMgW2ZhbHNlXSAtIFNldCB0byB0cnVlIGluIG9yZGVyIHRvIGFsbG93IHRlc3RcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhY2thZ2VzIGluc3RhbGxhdGlvbi5cbiAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gdXNlU2RjYXJkIFtmYWxzZV0gLSBTZXQgdG8gdHJ1ZSB0byBpbnN0YWxsIHRoZSBhcHAgb24gc2RjYXJkXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5zdGVhZCBvZiB0aGUgZGV2aWNlIG1lbW9yeS5cbiAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gZ3JhbnRQZXJtaXNzaW9ucyBbZmFsc2VdIC0gU2V0IHRvIHRydWUgaW4gb3JkZXIgdG8gZ3JhbnQgYWxsIHRoZVxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwZXJtaXNzaW9ucyByZXF1ZXN0ZWQgaW4gdGhlIGFwcGxpY2F0aW9uJ3MgbWFuaWZlc3RcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXV0b21hdGljYWxseSBhZnRlciB0aGUgaW5zdGFsbGF0aW9uIGlzIGNvbXBsZXRlZFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bmRlciBBbmRyb2lkIDYrLlxuICogQHByb3BlcnR5IHtib29sZWFufSByZXBsYWNlIFt0cnVlXSAtIFNldCBpdCB0byBmYWxzZSBpZiB5b3UgZG9uJ3Qgd2FudFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoZSBhcHBsaWNhdGlvbiB0byBiZSB1cGdyYWRlZC9yZWluc3RhbGxlZFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGl0IGlzIGFscmVhZHkgcHJlc2VudCBvbiB0aGUgZGV2aWNlLlxuICovXG5cbi8qKlxuICogSW5zdGFsbCB0aGUgcGFja2FnZSBmcm9tIHRoZSBsb2NhbCBmaWxlIHN5c3RlbS5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gYXBwUGF0aCAtIFRoZSBmdWxsIHBhdGggdG8gdGhlIGxvY2FsIHBhY2thZ2UuXG4gKiBAcGFyYW0gez9JbnN0YWxsT3B0aW9uc30gb3B0aW9ucyAtIFRoZSBzZXQgb2YgaW5zdGFsbGF0aW9uIG9wdGlvbnMuXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgYW4gdW5leHBlY3RlZCBlcnJvciBoYXBwZW5zIGR1cmluZyBpbnN0YWxsLlxuICovXG5hcGtVdGlsc01ldGhvZHMuaW5zdGFsbCA9IGFzeW5jIGZ1bmN0aW9uIGluc3RhbGwgKGFwcFBhdGgsIG9wdGlvbnMgPSB7fSkge1xuICBpZiAoYXBwUGF0aC5lbmRzV2l0aChBUEtTX0VYVEVOU0lPTikpIHtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5pbnN0YWxsQXBrcyhhcHBQYXRoLCBvcHRpb25zKTtcbiAgfVxuXG4gIG9wdGlvbnMgPSBfLmNsb25lRGVlcChvcHRpb25zKTtcbiAgXy5kZWZhdWx0cyhvcHRpb25zLCB7XG4gICAgcmVwbGFjZTogdHJ1ZSxcbiAgICB0aW1lb3V0OiB0aGlzLmFkYkV4ZWNUaW1lb3V0ID09PSBERUZBVUxUX0FEQl9FWEVDX1RJTUVPVVQgPyBBUEtfSU5TVEFMTF9USU1FT1VUIDogdGhpcy5hZGJFeGVjVGltZW91dCxcbiAgICB0aW1lb3V0Q2FwTmFtZTogJ2FuZHJvaWRJbnN0YWxsVGltZW91dCcsXG4gIH0pO1xuXG4gIGNvbnN0IGluc3RhbGxBcmdzID0gYnVpbGRJbnN0YWxsQXJncyhhd2FpdCB0aGlzLmdldEFwaUxldmVsKCksIG9wdGlvbnMpO1xuICBjb25zdCBpbnN0YWxsT3B0cyA9IHtcbiAgICB0aW1lb3V0OiBvcHRpb25zLnRpbWVvdXQsXG4gICAgdGltZW91dENhcE5hbWU6IG9wdGlvbnMudGltZW91dENhcE5hbWUsXG4gIH07XG4gIGxldCBwZXJmb3JtQXBwSW5zdGFsbCA9IGFzeW5jICgpID0+IGF3YWl0IHRoaXMuYWRiRXhlYyhbXG4gICAgJ2luc3RhbGwnLFxuICAgIC4uLmluc3RhbGxBcmdzLFxuICAgIGFwcFBhdGhcbiAgXSwgaW5zdGFsbE9wdHMpO1xuICAvLyB0aGlzLnJlbW90ZUFwcHNDYWNoZUxpbWl0IDw9IDAgbWVhbnMgbm8gY2FjaGluZyBzaG91bGQgYmUgYXBwbGllZFxuICBpZiAodGhpcy5yZW1vdGVBcHBzQ2FjaGVMaW1pdCA+IDApIHtcbiAgICBjb25zdCBjYWNoZWRSZW1vdGVQYXRoID0gYXdhaXQgdGhpcy5jYWNoZUFwayhhcHBQYXRoLCB7XG4gICAgICB0aW1lb3V0OiBvcHRpb25zLnRpbWVvdXQsXG4gICAgfSk7XG4gICAgcGVyZm9ybUFwcEluc3RhbGwgPSBhc3luYyAoKSA9PiBhd2FpdCB0aGlzLnNoZWxsKFtcbiAgICAgICdwbScsXG4gICAgICAnaW5zdGFsbCcsXG4gICAgICAuLi5pbnN0YWxsQXJncyxcbiAgICAgIGNhY2hlZFJlbW90ZVBhdGhcbiAgICBdLCBpbnN0YWxsT3B0cyk7XG4gIH1cbiAgdHJ5IHtcbiAgICBjb25zdCBzdGFydGVkID0gcHJvY2Vzcy5ocnRpbWUoKTtcbiAgICBjb25zdCBvdXRwdXQgPSBhd2FpdCBwZXJmb3JtQXBwSW5zdGFsbCgpO1xuICAgIGNvbnN0IFtzZWNvbmRzLCBuYW5vc10gPSBwcm9jZXNzLmhydGltZShzdGFydGVkKTtcbiAgICBsb2cuaW5mbyhgVGhlIGluc3RhbGxhdGlvbiBvZiAnJHtwYXRoLmJhc2VuYW1lKGFwcFBhdGgpfScgdG9vayAkeyhzZWNvbmRzICsgbmFub3MgLyAxZTkpLnRvRml4ZWQoMyl9c2ApO1xuICAgIGNvbnN0IHRydW5jYXRlZE91dHB1dCA9ICghXy5pc1N0cmluZyhvdXRwdXQpIHx8IG91dHB1dC5sZW5ndGggPD0gMzAwKSA/XG4gICAgICBvdXRwdXQgOiBgJHtvdXRwdXQuc3Vic3RyKDAsIDE1MCl9Li4uJHtvdXRwdXQuc3Vic3RyKG91dHB1dC5sZW5ndGggLSAxNTApfWA7XG4gICAgbG9nLmRlYnVnKGBJbnN0YWxsIGNvbW1hbmQgc3Rkb3V0OiAke3RydW5jYXRlZE91dHB1dH1gKTtcbiAgICBpZiAoL1xcW0lOU1RBTExbQS1aX10rRkFJTEVEW0EtWl9dK1xcXS8udGVzdChvdXRwdXQpKSB7XG4gICAgICBpZiAodGhpcy5pc1Rlc3RQYWNrYWdlT25seUVycm9yKG91dHB1dCkpIHtcbiAgICAgICAgY29uc3QgbXNnID0gYFNldCAnYWxsb3dUZXN0UGFja2FnZXMnIGNhcGFiaWxpdHkgdG8gdHJ1ZSBpbiBvcmRlciB0byBhbGxvdyB0ZXN0IHBhY2thZ2VzIGluc3RhbGxhdGlvbi5gO1xuICAgICAgICBsb2cud2Fybihtc2cpO1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYCR7b3V0cHV0fVxcbiR7bXNnfWApO1xuICAgICAgfVxuICAgICAgdGhyb3cgbmV3IEVycm9yKG91dHB1dCk7XG4gICAgfVxuICB9IGNhdGNoIChlcnIpIHtcbiAgICAvLyBvbiBzb21lIHN5c3RlbXMgdGhpcyB3aWxsIHRocm93IGFuIGVycm9yIGlmIHRoZSBhcHAgYWxyZWFkeVxuICAgIC8vIGV4aXN0c1xuICAgIGlmICghZXJyLm1lc3NhZ2UuaW5jbHVkZXMoJ0lOU1RBTExfRkFJTEVEX0FMUkVBRFlfRVhJU1RTJykpIHtcbiAgICAgIHRocm93IGVycjtcbiAgICB9XG4gICAgbG9nLmRlYnVnKGBBcHBsaWNhdGlvbiAnJHthcHBQYXRofScgYWxyZWFkeSBpbnN0YWxsZWQuIENvbnRpbnVpbmcuYCk7XG4gIH1cbn07XG5cbi8qKlxuICogUmV0cmlldmVzIHRoZSBjdXJyZW50IGluc3RhbGxhdGlvbiBzdGF0ZSBvZiB0aGUgcGFydGljdWxhciBhcHBsaWNhdGlvblxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBhcHBQYXRoIC0gRnVsbCBwYXRoIHRvIHRoZSBhcHBsaWNhdGlvblxuICogQHBhcmFtIHs/c3RyaW5nfSBwa2cgLSBQYWNrYWdlIGlkZW50aWZpZXIuIElmIG9taXR0ZWQgdGhlbiB0aGUgc2NyaXB0IHdpbGxcbiAqICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHRvIGV4dHJhY3QgaXQgb24gaXRzIG93blxuICogQHJldHVybnMge3N0cmluZ31dT25lIG9mIGBBUFBfSU5TVEFMTF9TVEFURWAgY29uc3RhbnRzXG4gKi9cbmFwa1V0aWxzTWV0aG9kcy5nZXRBcHBsaWNhdGlvbkluc3RhbGxTdGF0ZSA9IGFzeW5jIGZ1bmN0aW9uIGdldEFwcGxpY2F0aW9uSW5zdGFsbFN0YXRlIChhcHBQYXRoLCBwa2cgPSBudWxsKSB7XG4gIGxldCBhcGtJbmZvID0gbnVsbDtcbiAgaWYgKCFwa2cpIHtcbiAgICBhcGtJbmZvID0gYXdhaXQgdGhpcy5nZXRBcGtJbmZvKGFwcFBhdGgpO1xuICAgIHBrZyA9IGFwa0luZm8ubmFtZTtcbiAgfVxuICBpZiAoIXBrZykge1xuICAgIGxvZy53YXJuKGBDYW5ub3QgcmVhZCB0aGUgcGFja2FnZSBuYW1lIG9mICcke2FwcFBhdGh9J2ApO1xuICAgIHJldHVybiB0aGlzLkFQUF9JTlNUQUxMX1NUQVRFLlVOS05PV047XG4gIH1cblxuICBpZiAoIWF3YWl0IHRoaXMuaXNBcHBJbnN0YWxsZWQocGtnKSkge1xuICAgIGxvZy5kZWJ1ZyhgQXBwICcke2FwcFBhdGh9JyBpcyBub3QgaW5zdGFsbGVkYCk7XG4gICAgcmV0dXJuIHRoaXMuQVBQX0lOU1RBTExfU1RBVEUuTk9UX0lOU1RBTExFRDtcbiAgfVxuXG4gIGNvbnN0IHt2ZXJzaW9uQ29kZTogcGtnVmVyc2lvbkNvZGUsIHZlcnNpb25OYW1lOiBwa2dWZXJzaW9uTmFtZVN0cn0gPSBhd2FpdCB0aGlzLmdldFBhY2thZ2VJbmZvKHBrZyk7XG4gIGNvbnN0IHBrZ1ZlcnNpb25OYW1lID0gc2VtdmVyLnZhbGlkKHNlbXZlci5jb2VyY2UocGtnVmVyc2lvbk5hbWVTdHIpKTtcbiAgaWYgKCFhcGtJbmZvKSB7XG4gICAgYXBrSW5mbyA9IGF3YWl0IHRoaXMuZ2V0QXBrSW5mbyhhcHBQYXRoKTtcbiAgfVxuICBjb25zdCB7dmVyc2lvbkNvZGU6IGFwa1ZlcnNpb25Db2RlLCB2ZXJzaW9uTmFtZTogYXBrVmVyc2lvbk5hbWVTdHJ9ID0gYXBrSW5mbztcbiAgY29uc3QgYXBrVmVyc2lvbk5hbWUgPSBzZW12ZXIudmFsaWQoc2VtdmVyLmNvZXJjZShhcGtWZXJzaW9uTmFtZVN0cikpO1xuXG4gIGlmICghXy5pc0ludGVnZXIoYXBrVmVyc2lvbkNvZGUpIHx8ICFfLmlzSW50ZWdlcihwa2dWZXJzaW9uQ29kZSkpIHtcbiAgICBsb2cud2FybihgQ2Fubm90IHJlYWQgdmVyc2lvbiBjb2RlcyBvZiAnJHthcHBQYXRofScgYW5kL29yICcke3BrZ30nYCk7XG4gICAgaWYgKCFfLmlzU3RyaW5nKGFwa1ZlcnNpb25OYW1lKSB8fCAhXy5pc1N0cmluZyhwa2dWZXJzaW9uTmFtZSkpIHtcbiAgICAgIGxvZy53YXJuKGBDYW5ub3QgcmVhZCB2ZXJzaW9uIG5hbWVzIG9mICcke2FwcFBhdGh9JyBhbmQvb3IgJyR7cGtnfSdgKTtcbiAgICAgIHJldHVybiB0aGlzLkFQUF9JTlNUQUxMX1NUQVRFLlVOS05PV047XG4gICAgfVxuICB9XG4gIGlmIChfLmlzSW50ZWdlcihhcGtWZXJzaW9uQ29kZSkgJiYgXy5pc0ludGVnZXIocGtnVmVyc2lvbkNvZGUpKSB7XG4gICAgaWYgKHBrZ1ZlcnNpb25Db2RlID4gYXBrVmVyc2lvbkNvZGUpIHtcbiAgICAgIGxvZy5kZWJ1ZyhgVGhlIHZlcnNpb24gY29kZSBvZiB0aGUgaW5zdGFsbGVkICcke3BrZ30nIGlzIGdyZWF0ZXIgdGhhbiB0aGUgYXBwbGljYXRpb24gdmVyc2lvbiBjb2RlICgke3BrZ1ZlcnNpb25Db2RlfSA+ICR7YXBrVmVyc2lvbkNvZGV9KWApO1xuICAgICAgcmV0dXJuIHRoaXMuQVBQX0lOU1RBTExfU1RBVEUuTkVXRVJfVkVSU0lPTl9JTlNUQUxMRUQ7XG4gICAgfVxuICAgIC8vIFZlcnNpb24gY29kZXMgbWlnaHQgbm90IGJlIG1haW50YWluZWQuIENoZWNrIHZlcnNpb24gbmFtZXMuXG4gICAgaWYgKHBrZ1ZlcnNpb25Db2RlID09PSBhcGtWZXJzaW9uQ29kZSkge1xuICAgICAgaWYgKF8uaXNTdHJpbmcoYXBrVmVyc2lvbk5hbWUpICYmIF8uaXNTdHJpbmcocGtnVmVyc2lvbk5hbWUpICYmIHNlbXZlci5zYXRpc2ZpZXMocGtnVmVyc2lvbk5hbWUsIGA+PSR7YXBrVmVyc2lvbk5hbWV9YCkpIHtcbiAgICAgICAgbG9nLmRlYnVnKGBUaGUgdmVyc2lvbiBuYW1lIG9mIHRoZSBpbnN0YWxsZWQgJyR7cGtnfScgaXMgZ3JlYXRlciBvciBlcXVhbCB0byB0aGUgYXBwbGljYXRpb24gdmVyc2lvbiBuYW1lICgnJHtwa2dWZXJzaW9uTmFtZX0nID49ICcke2Fwa1ZlcnNpb25OYW1lfScpYCk7XG4gICAgICAgIHJldHVybiBzZW12ZXIuc2F0aXNmaWVzKHBrZ1ZlcnNpb25OYW1lLCBgPiR7YXBrVmVyc2lvbk5hbWV9YClcbiAgICAgICAgICA/IHRoaXMuQVBQX0lOU1RBTExfU1RBVEUuTkVXRVJfVkVSU0lPTl9JTlNUQUxMRURcbiAgICAgICAgICA6IHRoaXMuQVBQX0lOU1RBTExfU1RBVEUuU0FNRV9WRVJTSU9OX0lOU1RBTExFRDtcbiAgICAgIH1cbiAgICAgIGlmICghXy5pc1N0cmluZyhhcGtWZXJzaW9uTmFtZSkgfHwgIV8uaXNTdHJpbmcocGtnVmVyc2lvbk5hbWUpKSB7XG4gICAgICAgIGxvZy5kZWJ1ZyhgVGhlIHZlcnNpb24gbmFtZSBvZiB0aGUgaW5zdGFsbGVkICcke3BrZ30nIGlzIGVxdWFsIHRvIGFwcGxpY2F0aW9uIHZlcnNpb24gbmFtZSAoJHtwa2dWZXJzaW9uQ29kZX0gPT09ICR7YXBrVmVyc2lvbkNvZGV9KWApO1xuICAgICAgICByZXR1cm4gdGhpcy5BUFBfSU5TVEFMTF9TVEFURS5TQU1FX1ZFUlNJT05fSU5TVEFMTEVEO1xuICAgICAgfVxuICAgIH1cbiAgfSBlbHNlIGlmIChfLmlzU3RyaW5nKGFwa1ZlcnNpb25OYW1lKSAmJiBfLmlzU3RyaW5nKHBrZ1ZlcnNpb25OYW1lKSAmJiBzZW12ZXIuc2F0aXNmaWVzKHBrZ1ZlcnNpb25OYW1lLCBgPj0ke2Fwa1ZlcnNpb25OYW1lfWApKSB7XG4gICAgbG9nLmRlYnVnKGBUaGUgdmVyc2lvbiBuYW1lIG9mIHRoZSBpbnN0YWxsZWQgJyR7cGtnfScgaXMgZ3JlYXRlciBvciBlcXVhbCB0byB0aGUgYXBwbGljYXRpb24gdmVyc2lvbiBuYW1lICgnJHtwa2dWZXJzaW9uTmFtZX0nID49ICcke2Fwa1ZlcnNpb25OYW1lfScpYCk7XG4gICAgcmV0dXJuIHNlbXZlci5zYXRpc2ZpZXMocGtnVmVyc2lvbk5hbWUsIGA+JHthcGtWZXJzaW9uTmFtZX1gKVxuICAgICAgPyB0aGlzLkFQUF9JTlNUQUxMX1NUQVRFLk5FV0VSX1ZFUlNJT05fSU5TVEFMTEVEXG4gICAgICA6IHRoaXMuQVBQX0lOU1RBTExfU1RBVEUuU0FNRV9WRVJTSU9OX0lOU1RBTExFRDtcbiAgfVxuXG4gIGxvZy5kZWJ1ZyhgVGhlIGluc3RhbGxlZCAnJHtwa2d9JyBwYWNrYWdlIGlzIG9sZGVyIHRoYW4gJyR7YXBwUGF0aH0nICgke3BrZ1ZlcnNpb25Db2RlfSA8ICR7YXBrVmVyc2lvbkNvZGV9IG9yICcke3BrZ1ZlcnNpb25OYW1lfScgPCAnJHthcGtWZXJzaW9uTmFtZX0nKSdgKTtcbiAgcmV0dXJuIHRoaXMuQVBQX0lOU1RBTExfU1RBVEUuT0xERVJfVkVSU0lPTl9JTlNUQUxMRUQ7XG59O1xuXG4vKipcbiAqIEB0eXBlZGVmIHtPYmplY3R9IEluc3RhbGxPclVwZ3JhZGVPcHRpb25zXG4gKiBAcHJvcGVydHkge251bWJlcn0gdGltZW91dCBbNjAwMDBdIC0gVGhlIGNvdW50IG9mIG1pbGxpc2Vjb25kcyB0byB3YWl0IHVudGlsIHRoZVxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcCBpcyBpbnN0YWxsZWQuXG4gKiBAcHJvcGVydHkge2Jvb2xlYW59IGFsbG93VGVzdFBhY2thZ2VzIFtmYWxzZV0gLSBTZXQgdG8gdHJ1ZSBpbiBvcmRlciB0byBhbGxvdyB0ZXN0XG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYWNrYWdlcyBpbnN0YWxsYXRpb24uXG4gKiBAcHJvcGVydHkge2Jvb2xlYW59IHVzZVNkY2FyZCBbZmFsc2VdIC0gU2V0IHRvIHRydWUgdG8gaW5zdGFsbCB0aGUgYXBwIG9uIFNEQ2FyZFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluc3RlYWQgb2YgdGhlIGRldmljZSBtZW1vcnkuXG4gKiBAcHJvcGVydHkge2Jvb2xlYW59IGdyYW50UGVybWlzc2lvbnMgW2ZhbHNlXSAtIFNldCB0byB0cnVlIGluIG9yZGVyIHRvIGdyYW50IGFsbCB0aGVcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGVybWlzc2lvbnMgcmVxdWVzdGVkIGluIHRoZSBhcHBsaWNhdGlvbidzIG1hbmlmZXN0XG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF1dG9tYXRpY2FsbHkgYWZ0ZXIgdGhlIGluc3RhbGxhdGlvbiBpcyBjb21wbGV0ZWRcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5kZXIgQW5kcm9pZCA2Ky5cbiAqL1xuXG4vKipcbiAqIEluc3RhbGwgdGhlIHBhY2thZ2UgZnJvbSB0aGUgbG9jYWwgZmlsZSBzeXN0ZW0gb3IgdXBncmFkZSBpdCBpZiBhbiBvbGRlclxuICogdmVyc2lvbiBvZiB0aGUgc2FtZSBwYWNrYWdlIGlzIGFscmVhZHkgaW5zdGFsbGVkLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBhcHBQYXRoIC0gVGhlIGZ1bGwgcGF0aCB0byB0aGUgbG9jYWwgcGFja2FnZS5cbiAqIEBwYXJhbSB7P3N0cmluZ30gcGtnIC0gVGhlIG5hbWUgb2YgdGhlIGluc3RhbGxlZCBwYWNrYWdlLiBUaGUgbWV0aG9kIHdpbGxcbiAqICAgICAgICAgICAgICAgICAgICAgICAgcGVyZm9ybSBmYXN0ZXIgaWYgaXQgaXMgc2V0LlxuICogQHBhcmFtIHs/SW5zdGFsbE9yVXBncmFkZU9wdGlvbnN9IG9wdGlvbnMgLSBTZXQgb2YgaW5zdGFsbCBvcHRpb25zLlxuICogQHRocm93cyB7RXJyb3J9IElmIGFuIHVuZXhwZWN0ZWQgZXJyb3IgaGFwcGVucyBkdXJpbmcgaW5zdGFsbC5cbiAqL1xuYXBrVXRpbHNNZXRob2RzLmluc3RhbGxPclVwZ3JhZGUgPSBhc3luYyBmdW5jdGlvbiBpbnN0YWxsT3JVcGdyYWRlIChhcHBQYXRoLCBwa2cgPSBudWxsLCBvcHRpb25zID0ge30pIHtcbiAgaWYgKCFwa2cpIHtcbiAgICBjb25zdCBhcGtJbmZvID0gYXdhaXQgdGhpcy5nZXRBcGtJbmZvKGFwcFBhdGgpO1xuICAgIHBrZyA9IGFwa0luZm8ubmFtZTtcbiAgfVxuXG4gIGNvbnN0IGFwcFN0YXRlID0gYXdhaXQgdGhpcy5nZXRBcHBsaWNhdGlvbkluc3RhbGxTdGF0ZShhcHBQYXRoLCBwa2cpO1xuICBzd2l0Y2ggKGFwcFN0YXRlKSB7XG4gICAgY2FzZSB0aGlzLkFQUF9JTlNUQUxMX1NUQVRFLk5PVF9JTlNUQUxMRUQ6XG4gICAgICBsb2cuZGVidWcoYEluc3RhbGxpbmcgJyR7YXBwUGF0aH0nYCk7XG4gICAgICBhd2FpdCB0aGlzLmluc3RhbGwoYXBwUGF0aCwgT2JqZWN0LmFzc2lnbih7fSwgb3B0aW9ucywge3JlcGxhY2U6IGZhbHNlfSkpO1xuICAgICAgcmV0dXJuO1xuICAgIGNhc2UgdGhpcy5BUFBfSU5TVEFMTF9TVEFURS5ORVdFUl9WRVJTSU9OX0lOU1RBTExFRDpcbiAgICBjYXNlIHRoaXMuQVBQX0lOU1RBTExfU1RBVEUuU0FNRV9WRVJTSU9OX0lOU1RBTExFRDpcbiAgICAgIGxvZy5kZWJ1ZyhgVGhlcmUgaXMgbm8gbmVlZCB0byBpbnN0YWxsL3VwZ3JhZGUgJyR7YXBwUGF0aH0nYCk7XG4gICAgICByZXR1cm47XG4gICAgY2FzZSB0aGlzLkFQUF9JTlNUQUxMX1NUQVRFLk9MREVSX1ZFUlNJT05fSU5TVEFMTEVEOlxuICAgICAgbG9nLmRlYnVnKGBFeGVjdXRpbmcgdXBncmFkZSBvZiAnJHthcHBQYXRofSdgKTtcbiAgICAgIGJyZWFrO1xuICAgIGRlZmF1bHQ6XG4gICAgICBsb2cuZGVidWcoYFRoZSBjdXJyZW50IGluc3RhbGwgc3RhdGUgb2YgJyR7YXBwUGF0aH0nIGlzIHVua25vd24uIEluc3RhbGxpbmcgYW55d2F5YCk7XG4gICAgICBicmVhaztcbiAgfVxuXG4gIHRyeSB7XG4gICAgYXdhaXQgdGhpcy5pbnN0YWxsKGFwcFBhdGgsIE9iamVjdC5hc3NpZ24oe30sIG9wdGlvbnMsIHtyZXBsYWNlOiB0cnVlfSkpO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBsb2cud2FybihgQ2Fubm90IHVwZ3JhZGUgJyR7cGtnfScgYmVjYXVzZSBvZiAnJHtlcnIubWVzc2FnZX0nLiBUcnlpbmcgZnVsbCByZWluc3RhbGxgKTtcbiAgICBpZiAoIWF3YWl0IHRoaXMudW5pbnN0YWxsQXBrKHBrZykpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgJyR7cGtnfScgcGFja2FnZSBjYW5ub3QgYmUgdW5pbnN0YWxsZWRgKTtcbiAgICB9XG4gICAgYXdhaXQgdGhpcy5pbnN0YWxsKGFwcFBhdGgsIE9iamVjdC5hc3NpZ24oe30sIG9wdGlvbnMsIHtyZXBsYWNlOiBmYWxzZX0pKTtcbiAgfVxufTtcblxuLyoqXG4gKiBFeHRyYWN0IHN0cmluZyByZXNvdXJjZXMgZnJvbSB0aGUgZ2l2ZW4gcGFja2FnZSBvbiBsb2NhbCBmaWxlIHN5c3RlbS5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gYXBwUGF0aCAtIFRoZSBmdWxsIHBhdGggdG8gdGhlIC5hcGsocykgcGFja2FnZS5cbiAqIEBwYXJhbSB7P3N0cmluZ30gbGFuZ3VhZ2UgLSBUaGUgbmFtZSBvZiB0aGUgbGFuZ3VhZ2UgdG8gZXh0cmFjdCB0aGUgcmVzb3VyY2VzIGZvci5cbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUaGUgZGVmYXVsdCBsYW5ndWFnZSBpcyB1c2VkIGlmIHRoaXMgZXF1YWxzIHRvIGBudWxsYC9gdW5kZWZpbmVkYFxuICogQHBhcmFtIHtzdHJpbmd9IG91dCAtIFRoZSBuYW1lIG9mIHRoZSBkZXN0aW5hdGlvbiBmb2xkZXIgb24gdGhlIGxvY2FsIGZpbGUgc3lzdGVtIHRvXG4gKiAgICAgICAgICAgICAgICAgICAgICAgc3RvcmUgdGhlIGV4dHJhY3RlZCBmaWxlIHRvLlxuICogQHJldHVybiB7T2JqZWN0fSBBIG1hcHBpbmcgb2JqZWN0LCB3aGVyZSBwcm9wZXJ0aWVzIGFyZTogJ2Fwa1N0cmluZ3MnLCBjb250YWluaW5nXG4gKiAgICAgICAgICAgICAgICAgIHBhcnNlZCByZXNvdXJjZSBmaWxlIHJlcHJlc2VudGVkIGFzIEpTT04gb2JqZWN0LCBhbmQgJ2xvY2FsUGF0aCcsXG4gKiAgICAgICAgICAgICAgICAgIGNvbnRhaW5pbmcgdGhlIHBhdGggdG8gdGhlIGV4dHJhY3RlZCBmaWxlIG9uIHRoZSBsb2NhbCBmaWxlIHN5c3RlbS5cbiAqL1xuYXBrVXRpbHNNZXRob2RzLmV4dHJhY3RTdHJpbmdzRnJvbUFwayA9IGFzeW5jIGZ1bmN0aW9uIGV4dHJhY3RTdHJpbmdzRnJvbUFwayAoYXBwUGF0aCwgbGFuZ3VhZ2UsIG91dCkge1xuICBsb2cuZGVidWcoYEV4dHJhY3Rpbmcgc3RyaW5ncyBmcm9tIGZvciBsYW5ndWFnZTogJHtsYW5ndWFnZSB8fCAnZGVmYXVsdCd9YCk7XG4gIGNvbnN0IG9yaWdpbmFsQXBwUGF0aCA9IGFwcFBhdGg7XG4gIGlmIChhcHBQYXRoLmVuZHNXaXRoKEFQS1NfRVhURU5TSU9OKSkge1xuICAgIGFwcFBhdGggPSBhd2FpdCB0aGlzLmV4dHJhY3RMYW5ndWFnZUFwayhhcHBQYXRoLCBsYW5ndWFnZSk7XG4gIH1cblxuICBsZXQgYXBrU3RyaW5ncyA9IHt9O1xuICBsZXQgY29uZmlnTWFya2VyO1xuICB0cnkge1xuICAgIGF3YWl0IHRoaXMuaW5pdEFhcHQoKTtcblxuICAgIGNvbmZpZ01hcmtlciA9IGF3YWl0IGZvcm1hdENvbmZpZ01hcmtlcihhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB7c3Rkb3V0fSA9IGF3YWl0IGV4ZWModGhpcy5iaW5hcmllcy5hYXB0LCBbXG4gICAgICAgICdkJyxcbiAgICAgICAgJ2NvbmZpZ3VyYXRpb25zJyxcbiAgICAgICAgYXBwUGF0aCxcbiAgICAgIF0pO1xuICAgICAgcmV0dXJuIHN0ZG91dC5zcGxpdChvcy5FT0wpO1xuICAgIH0sIGxhbmd1YWdlLCAnKGRlZmF1bHQpJyk7XG5cbiAgICBjb25zdCB7c3Rkb3V0fSA9IGF3YWl0IGV4ZWModGhpcy5iaW5hcmllcy5hYXB0LCBbXG4gICAgICAnZCcsXG4gICAgICAnLS12YWx1ZXMnLFxuICAgICAgJ3Jlc291cmNlcycsXG4gICAgICBhcHBQYXRoLFxuICAgIF0pO1xuICAgIGFwa1N0cmluZ3MgPSBwYXJzZUFhcHRTdHJpbmdzKHN0ZG91dCwgY29uZmlnTWFya2VyKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIGxvZy5kZWJ1ZygnQ2Fubm90IGV4dHJhY3QgcmVzb3VyY2VzIHVzaW5nIGFhcHQuIFRyeWluZyBhYXB0Mi4gJyArXG4gICAgICBgT3JpZ2luYWwgZXJyb3I6ICR7ZS5zdGRlcnIgfHwgZS5tZXNzYWdlfWApO1xuXG4gICAgYXdhaXQgdGhpcy5pbml0QWFwdDIoKTtcblxuICAgIGNvbmZpZ01hcmtlciA9IGF3YWl0IGZvcm1hdENvbmZpZ01hcmtlcihhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBhcGthbmFseXplclBhdGggPSBhd2FpdCBnZXRBcGthbmFseXplckZvck9zKHRoaXMpO1xuICAgICAgY29uc3Qge3N0ZG91dH0gPSBhd2FpdCBleGVjKGFwa2FuYWx5emVyUGF0aCwgW1xuICAgICAgICAncmVzb3VyY2VzJywgJ2NvbmZpZ3MnLFxuICAgICAgICAnLS10eXBlJywgJ3N0cmluZycsXG4gICAgICAgIGFwcFBhdGgsXG4gICAgICBdLCB7XG4gICAgICAgIHNoZWxsOiB0cnVlLFxuICAgICAgICBjd2Q6IHBhdGguZGlybmFtZShhcGthbmFseXplclBhdGgpLFxuICAgICAgfSk7XG4gICAgICByZXR1cm4gc3Rkb3V0LnNwbGl0KG9zLkVPTCk7XG4gICAgfSwgbGFuZ3VhZ2UsICcnKTtcblxuICAgIHRyeSB7XG4gICAgICBjb25zdCB7c3Rkb3V0fSA9IGF3YWl0IGV4ZWModGhpcy5iaW5hcmllcy5hYXB0MiwgW1xuICAgICAgICAnZHVtcCcsIGFwcFBhdGgsXG4gICAgICBdKTtcbiAgICAgIGFwa1N0cmluZ3MgPSBwYXJzZUFhcHQyU3RyaW5ncyhzdGRvdXQsIGNvbmZpZ01hcmtlcik7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBDYW5ub3QgZXh0cmFjdCByZXNvdXJjZXMgZnJvbSAnJHtvcmlnaW5hbEFwcFBhdGh9Jy4gYCArXG4gICAgICAgIGBPcmlnaW5hbCBlcnJvcjogJHtlLm1lc3NhZ2V9YCk7XG4gICAgfVxuICB9XG5cbiAgaWYgKF8uaXNFbXB0eShhcGtTdHJpbmdzKSkge1xuICAgIGxvZy53YXJuKGBObyBzdHJpbmdzIGhhdmUgYmVlbiBmb3VuZCBpbiAnJHtvcmlnaW5hbEFwcFBhdGh9JyByZXNvdXJjZXMgYCArXG4gICAgICBgZm9yICcke2NvbmZpZ01hcmtlciB8fCAnZGVmYXVsdCd9JyBjb25maWd1cmF0aW9uYCk7XG4gIH0gZWxzZSB7XG4gICAgbG9nLmluZm8oYFN1Y2Nlc3NmdWxseSBleHRyYWN0ZWQgJHtfLmtleXMoYXBrU3RyaW5ncykubGVuZ3RofSBzdHJpbmdzIGZyb20gYCArXG4gICAgICBgJyR7b3JpZ2luYWxBcHBQYXRofScgcmVzb3VyY2VzIGZvciAnJHtjb25maWdNYXJrZXIgfHwgJ2RlZmF1bHQnfScgY29uZmlndXJhdGlvbmApO1xuICB9XG5cbiAgY29uc3QgbG9jYWxQYXRoID0gcGF0aC5yZXNvbHZlKG91dCwgJ3N0cmluZ3MuanNvbicpO1xuICBhd2FpdCBta2RpcnAob3V0KTtcbiAgYXdhaXQgZnMud3JpdGVGaWxlKGxvY2FsUGF0aCwgSlNPTi5zdHJpbmdpZnkoYXBrU3RyaW5ncywgbnVsbCwgMiksICd1dGYtOCcpO1xuICByZXR1cm4ge2Fwa1N0cmluZ3MsIGxvY2FsUGF0aH07XG59O1xuXG4vKipcbiAqIEdldCB0aGUgbGFuZ3VhZ2UgbmFtZSBvZiB0aGUgZGV2aWNlIHVuZGVyIHRlc3QuXG4gKlxuICogQHJldHVybiB7c3RyaW5nfSBUaGUgbmFtZSBvZiBkZXZpY2UgbGFuZ3VhZ2UuXG4gKi9cbmFwa1V0aWxzTWV0aG9kcy5nZXREZXZpY2VMYW5ndWFnZSA9IGFzeW5jIGZ1bmN0aW9uIGdldERldmljZUxhbmd1YWdlICgpIHtcbiAgbGV0IGxhbmd1YWdlO1xuICBpZiAoYXdhaXQgdGhpcy5nZXRBcGlMZXZlbCgpIDwgMjMpIHtcbiAgICBsYW5ndWFnZSA9IGF3YWl0IHRoaXMuZ2V0RGV2aWNlU3lzTGFuZ3VhZ2UoKTtcbiAgICBpZiAoIWxhbmd1YWdlKSB7XG4gICAgICBsYW5ndWFnZSA9IGF3YWl0IHRoaXMuZ2V0RGV2aWNlUHJvZHVjdExhbmd1YWdlKCk7XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIGxhbmd1YWdlID0gKGF3YWl0IHRoaXMuZ2V0RGV2aWNlTG9jYWxlKCkpLnNwbGl0KCctJylbMF07XG4gIH1cbiAgcmV0dXJuIGxhbmd1YWdlO1xufTtcblxuLyoqXG4gKiBHZXQgdGhlIGNvdW50cnkgbmFtZSBvZiB0aGUgZGV2aWNlIHVuZGVyIHRlc3QuXG4gKlxuICogQHJldHVybiB7c3RyaW5nfSBUaGUgbmFtZSBvZiBkZXZpY2UgY291bnRyeS5cbiAqL1xuYXBrVXRpbHNNZXRob2RzLmdldERldmljZUNvdW50cnkgPSBhc3luYyBmdW5jdGlvbiBnZXREZXZpY2VDb3VudHJ5ICgpIHtcbiAgLy8gdGhpcyBtZXRob2QgaXMgb25seSB1c2VkIGluIEFQSSA8IDIzXG4gIGxldCBjb3VudHJ5ID0gYXdhaXQgdGhpcy5nZXREZXZpY2VTeXNDb3VudHJ5KCk7XG4gIGlmICghY291bnRyeSkge1xuICAgIGNvdW50cnkgPSBhd2FpdCB0aGlzLmdldERldmljZVByb2R1Y3RDb3VudHJ5KCk7XG4gIH1cbiAgcmV0dXJuIGNvdW50cnk7XG59O1xuXG4vKipcbiAqIEdldCB0aGUgbG9jYWxlIG5hbWUgb2YgdGhlIGRldmljZSB1bmRlciB0ZXN0LlxuICpcbiAqIEByZXR1cm4ge3N0cmluZ30gVGhlIG5hbWUgb2YgZGV2aWNlIGxvY2FsZS5cbiAqL1xuYXBrVXRpbHNNZXRob2RzLmdldERldmljZUxvY2FsZSA9IGFzeW5jIGZ1bmN0aW9uIGdldERldmljZUxvY2FsZSAoKSB7XG4gIC8vIHRoaXMgbWV0aG9kIGlzIG9ubHkgdXNlZCBpbiBBUEkgPj0gMjNcbiAgbGV0IGxvY2FsZSA9IGF3YWl0IHRoaXMuZ2V0RGV2aWNlU3lzTG9jYWxlKCk7XG4gIGlmICghbG9jYWxlKSB7XG4gICAgbG9jYWxlID0gYXdhaXQgdGhpcy5nZXREZXZpY2VQcm9kdWN0TG9jYWxlKCk7XG4gIH1cbiAgcmV0dXJuIGxvY2FsZTtcbn07XG5cbi8qKlxuICogU2V0IHRoZSBsb2NhbGUgbmFtZSBvZiB0aGUgZGV2aWNlIHVuZGVyIHRlc3QgYW5kIHRoZSBmb3JtYXQgb2YgdGhlIGxvY2FsZSBpcyBlbi1VUywgZm9yIGV4YW1wbGUuXG4gKiBUaGlzIG1ldGhvZCBjYWxsIHNldERldmljZUxhbmd1YWdlQ291bnRyeSwgc28sIHBsZWFzZSB1c2Ugc2V0RGV2aWNlTGFuZ3VhZ2VDb3VudHJ5IGFzIHBvc3NpYmxlLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBsb2NhbGUgLSBOYW1lcyBvZiB0aGUgZGV2aWNlIGxhbmd1YWdlIGFuZCB0aGUgY291bnRyeSBjb25uZWN0ZWQgd2l0aCBgLWAuIGUuZy4gZW4tVVMuXG4gKi9cbmFwa1V0aWxzTWV0aG9kcy5zZXREZXZpY2VMb2NhbGUgPSBhc3luYyBmdW5jdGlvbiBzZXREZXZpY2VMb2NhbGUgKGxvY2FsZSkge1xuICBjb25zdCB2YWxpZGF0ZUxvY2FsZSA9IG5ldyBSZWdFeHAoL1thLXpBLVpdKy1bYS16QS1aMC05XSsvKTtcbiAgaWYgKCF2YWxpZGF0ZUxvY2FsZS50ZXN0KGxvY2FsZSkpIHtcbiAgICBsb2cud2Fybihgc2V0RGV2aWNlTG9jYWxlIHJlcXVpcmVzIHRoZSBmb2xsb3dpbmcgZm9ybWF0OiBlbi1VUyBvciBqYS1KUGApO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGxldCBzcGxpdF9sb2NhbGUgPSBsb2NhbGUuc3BsaXQoJy0nKTtcbiAgYXdhaXQgdGhpcy5zZXREZXZpY2VMYW5ndWFnZUNvdW50cnkoc3BsaXRfbG9jYWxlWzBdLCBzcGxpdF9sb2NhbGVbMV0pO1xufTtcblxuLyoqXG4gKiBNYWtlIHN1cmUgY3VycmVudCBkZXZpY2UgbG9jYWxlIGlzIGV4cGVjdGVkIG9yIG5vdC5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gbGFuZ3VhZ2UgLSBMYW5ndWFnZS4gVGhlIGxhbmd1YWdlIGZpZWxkIGlzIGNhc2UgaW5zZW5zaXRpdmUsIGJ1dCBMb2NhbGUgYWx3YXlzIGNhbm9uaWNhbGl6ZXMgdG8gbG93ZXIgY2FzZS5cbiAqIEBwYXJhbSB7c3RyaW5nfSBjb3VudHJ5IC0gQ291bnRyeS4gVGhlIGxhbmd1YWdlIGZpZWxkIGlzIGNhc2UgaW5zZW5zaXRpdmUsIGJ1dCBMb2NhbGUgYWx3YXlzIGNhbm9uaWNhbGl6ZXMgdG8gbG93ZXIgY2FzZS5cbiAqIEBwYXJhbSB7P3N0cmluZ30gc2NyaXB0IC0gU2NyaXB0LiBUaGUgc2NyaXB0IGZpZWxkIGlzIGNhc2UgaW5zZW5zaXRpdmUgYnV0IExvY2FsZSBhbHdheXMgY2Fub25pY2FsaXplcyB0byB0aXRsZSBjYXNlLlxuICpcbiAqIEByZXR1cm4ge2Jvb2xlYW59IElmIGN1cnJlbnQgbG9jYWxlIGlzIGxhbmd1YWdlIGFuZCBjb3VudHJ5IGFzIGFyZ3VtZW50cywgcmV0dXJuIHRydWUuXG4gKi9cbmFwa1V0aWxzTWV0aG9kcy5lbnN1cmVDdXJyZW50TG9jYWxlID0gYXN5bmMgZnVuY3Rpb24gZW5zdXJlQ3VycmVudExvY2FsZSAobGFuZ3VhZ2UsIGNvdW50cnksIHNjcmlwdCA9IG51bGwpIHtcbiAgY29uc3QgaGFzTGFuZ3VhZ2UgPSBfLmlzU3RyaW5nKGxhbmd1YWdlKTtcbiAgY29uc3QgaGFzQ291bnRyeSA9IF8uaXNTdHJpbmcoY291bnRyeSk7XG5cbiAgaWYgKCFoYXNMYW5ndWFnZSAmJiAhaGFzQ291bnRyeSkge1xuICAgIGxvZy53YXJuKCdlbnN1cmVDdXJyZW50TG9jYWxlIHJlcXVpcmVzIGxhbmd1YWdlIG9yIGNvdW50cnknKTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICAvLyBnZXQgbG93ZXIgY2FzZSB2ZXJzaW9ucyBvZiB0aGUgc3RyaW5nc1xuICBsYW5ndWFnZSA9IChsYW5ndWFnZSB8fCAnJykudG9Mb3dlckNhc2UoKTtcbiAgY291bnRyeSA9IChjb3VudHJ5IHx8ICcnKS50b0xvd2VyQ2FzZSgpO1xuXG4gIGNvbnN0IGFwaUxldmVsID0gYXdhaXQgdGhpcy5nZXRBcGlMZXZlbCgpO1xuXG4gIHJldHVybiBhd2FpdCByZXRyeUludGVydmFsKDUsIDEwMDAsIGFzeW5jICgpID0+IHtcbiAgICB0cnkge1xuICAgICAgaWYgKGFwaUxldmVsIDwgMjMpIHtcbiAgICAgICAgbGV0IGN1ckxhbmd1YWdlLCBjdXJDb3VudHJ5O1xuICAgICAgICBpZiAoaGFzTGFuZ3VhZ2UpIHtcbiAgICAgICAgICBjdXJMYW5ndWFnZSA9IChhd2FpdCB0aGlzLmdldERldmljZUxhbmd1YWdlKCkpLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgaWYgKCFoYXNDb3VudHJ5ICYmIGxhbmd1YWdlID09PSBjdXJMYW5ndWFnZSkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChoYXNDb3VudHJ5KSB7XG4gICAgICAgICAgY3VyQ291bnRyeSA9IChhd2FpdCB0aGlzLmdldERldmljZUNvdW50cnkoKSkudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICBpZiAoIWhhc0xhbmd1YWdlICYmIGNvdW50cnkgPT09IGN1ckNvdW50cnkpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAobGFuZ3VhZ2UgPT09IGN1ckxhbmd1YWdlICYmIGNvdW50cnkgPT09IGN1ckNvdW50cnkpIHtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc3QgY3VyTG9jYWxlID0gKGF3YWl0IHRoaXMuZ2V0RGV2aWNlTG9jYWxlKCkpLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIC8vIHpoLWhhbnMtY24gOiB6aC1jblxuICAgICAgICBjb25zdCBsb2NhbGVDb2RlID0gc2NyaXB0ID8gYCR7bGFuZ3VhZ2V9LSR7c2NyaXB0LnRvTG93ZXJDYXNlKCl9LSR7Y291bnRyeX1gIDogYCR7bGFuZ3VhZ2V9LSR7Y291bnRyeX1gO1xuXG4gICAgICAgIGlmIChsb2NhbGVDb2RlID09PSBjdXJMb2NhbGUpIHtcbiAgICAgICAgICBsb2cuZGVidWcoYFJlcXVlc3RlZCBsb2NhbGUgaXMgZXF1YWwgdG8gY3VycmVudCBsb2NhbGU6ICcke2N1ckxvY2FsZX0nYCk7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIC8vIGlmIHRoZXJlIGhhcyBiZWVuIGFuIGVycm9yLCByZXN0YXJ0IGFkYiBhbmQgcmV0cnlcbiAgICAgIGxvZy5lcnJvcihgVW5hYmxlIHRvIGNoZWNrIGRldmljZSBsb2NhbGl6YXRpb246ICR7ZXJyLm1lc3NhZ2V9YCk7XG4gICAgICBsb2cuZGVidWcoJ1Jlc3RhcnRpbmcgQURCIGFuZCByZXRyeWluZy4uLicpO1xuICAgICAgYXdhaXQgdGhpcy5yZXN0YXJ0QWRiKCk7XG4gICAgICB0aHJvdyBlcnI7XG4gICAgfVxuICB9KTtcbn07XG5cbi8qKlxuICogU2V0IHRoZSBsb2NhbGUgbmFtZSBvZiB0aGUgZGV2aWNlIHVuZGVyIHRlc3QuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IGxhbmd1YWdlIC0gTGFuZ3VhZ2UuIFRoZSBsYW5ndWFnZSBmaWVsZCBpcyBjYXNlIGluc2Vuc2l0aXZlLCBidXQgTG9jYWxlIGFsd2F5cyBjYW5vbmljYWxpemVzIHRvIGxvd2VyIGNhc2UuXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6IFthLXpBLVpdezIsOH0uIGUuZy4gZW4sIGphIDogaHR0cHM6Ly9kZXZlbG9wZXIuYW5kcm9pZC5jb20vcmVmZXJlbmNlL2phdmEvdXRpbC9Mb2NhbGUuaHRtbFxuICogQHBhcmFtIHtzdHJpbmd9IGNvdW50cnkgLSBDb3VudHJ5LiBUaGUgY291bnRyeSAocmVnaW9uKSBmaWVsZCBpcyBjYXNlIGluc2Vuc2l0aXZlLCBidXQgTG9jYWxlIGFsd2F5cyBjYW5vbmljYWxpemVzIHRvIHVwcGVyIGNhc2UuXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6IFthLXpBLVpdezJ9IHwgWzAtOV17M30uIGUuZy4gVVMsIEpQIDogaHR0cHM6Ly9kZXZlbG9wZXIuYW5kcm9pZC5jb20vcmVmZXJlbmNlL2phdmEvdXRpbC9Mb2NhbGUuaHRtbFxuICogQHBhcmFtIHs/c3RyaW5nfSBzY3JpcHQgLSBTY3JpcHQuIFRoZSBzY3JpcHQgZmllbGQgaXMgY2FzZSBpbnNlbnNpdGl2ZSBidXQgTG9jYWxlIGFsd2F5cyBjYW5vbmljYWxpemVzIHRvIHRpdGxlIGNhc2UuXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6IFthLXpBLVpdezR9LiBlLmcuIEhhbnMgaW4gemgtSGFucy1DTiA6IGh0dHBzOi8vZGV2ZWxvcGVyLmFuZHJvaWQuY29tL3JlZmVyZW5jZS9qYXZhL3V0aWwvTG9jYWxlLmh0bWxcbiAqL1xuYXBrVXRpbHNNZXRob2RzLnNldERldmljZUxhbmd1YWdlQ291bnRyeSA9IGFzeW5jIGZ1bmN0aW9uIHNldERldmljZUxhbmd1YWdlQ291bnRyeSAobGFuZ3VhZ2UsIGNvdW50cnksIHNjcmlwdCA9IG51bGwpIHtcbiAgbGV0IGhhc0xhbmd1YWdlID0gbGFuZ3VhZ2UgJiYgXy5pc1N0cmluZyhsYW5ndWFnZSk7XG4gIGxldCBoYXNDb3VudHJ5ID0gY291bnRyeSAmJiBfLmlzU3RyaW5nKGNvdW50cnkpO1xuICBpZiAoIWhhc0xhbmd1YWdlIHx8ICFoYXNDb3VudHJ5KSB7XG4gICAgbG9nLndhcm4oYHNldERldmljZUxhbmd1YWdlQ291bnRyeSByZXF1aXJlcyBsYW5ndWFnZSBhbmQgY291bnRyeSBhdCBsZWFzdGApO1xuICAgIGxvZy53YXJuKGBHb3QgbGFuZ3VhZ2U6ICcke2xhbmd1YWdlfScgYW5kIGNvdW50cnk6ICcke2NvdW50cnl9J2ApO1xuICAgIHJldHVybjtcbiAgfVxuICBsZXQgYXBpTGV2ZWwgPSBhd2FpdCB0aGlzLmdldEFwaUxldmVsKCk7XG5cbiAgbGFuZ3VhZ2UgPSAobGFuZ3VhZ2UgfHwgJycpLnRvTG93ZXJDYXNlKCk7XG4gIGNvdW50cnkgPSAoY291bnRyeSB8fCAnJykudG9VcHBlckNhc2UoKTtcblxuICBpZiAoYXBpTGV2ZWwgPCAyMykge1xuICAgIGxldCBjdXJMYW5ndWFnZSA9IChhd2FpdCB0aGlzLmdldERldmljZUxhbmd1YWdlKCkpLnRvTG93ZXJDYXNlKCk7XG4gICAgbGV0IGN1ckNvdW50cnkgPSAoYXdhaXQgdGhpcy5nZXREZXZpY2VDb3VudHJ5KCkpLnRvVXBwZXJDYXNlKCk7XG5cbiAgICBpZiAobGFuZ3VhZ2UgIT09IGN1ckxhbmd1YWdlIHx8IGNvdW50cnkgIT09IGN1ckNvdW50cnkpIHtcbiAgICAgIGF3YWl0IHRoaXMuc2V0RGV2aWNlU3lzTG9jYWxlVmlhU2V0dGluZ0FwcChsYW5ndWFnZSwgY291bnRyeSk7XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIGxldCBjdXJMb2NhbGUgPSBhd2FpdCB0aGlzLmdldERldmljZUxvY2FsZSgpO1xuXG4gICAgLy8gemgtSGFucy1DTiA6IHpoLUNOXG4gICAgY29uc3QgbG9jYWxlQ29kZSA9IHNjcmlwdCA/IGAke2xhbmd1YWdlfS0ke3NjcmlwdH0tJHtjb3VudHJ5fWAgOiBgJHtsYW5ndWFnZX0tJHtjb3VudHJ5fWA7XG4gICAgbG9nLmRlYnVnKGBDdXJyZW50IGxvY2FsZTogJyR7Y3VyTG9jYWxlfSc7IHJlcXVlc3RlZCBsb2NhbGU6ICcke2xvY2FsZUNvZGV9J2ApO1xuICAgIGlmIChsb2NhbGVDb2RlLnRvTG93ZXJDYXNlKCkgIT09IGN1ckxvY2FsZS50b0xvd2VyQ2FzZSgpKSB7XG4gICAgICBhd2FpdCB0aGlzLnNldERldmljZVN5c0xvY2FsZVZpYVNldHRpbmdBcHAobGFuZ3VhZ2UsIGNvdW50cnksIHNjcmlwdCk7XG4gICAgfVxuICB9XG59O1xuXG4vKipcbiAqIEB0eXBlZGVmIHtPYmplY3R9IEFwcEluZm9cbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBuYW1lIC0gUGFja2FnZSBuYW1lLCBmb3IgZXhhbXBsZSAnY29tLmFjbWUuYXBwJy5cbiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSB2ZXJzaW9uQ29kZSAtIFZlcnNpb24gY29kZS5cbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSB2ZXJzaW9uTmFtZSAtIFZlcnNpb24gbmFtZSwgZm9yIGV4YW1wbGUgJzEuMCcuXG4gKi9cblxuLyoqXG4gKiBHZXQgdGhlIHBhY2thZ2UgaW5mbyBmcm9tIGxvY2FsIGFwayBmaWxlLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBhcHBQYXRoIC0gVGhlIGZ1bGwgcGF0aCB0byBleGlzdGluZyAuYXBrKHMpIHBhY2thZ2Ugb24gdGhlIGxvY2FsXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGUgc3lzdGVtLlxuICogQHJldHVybiB7P0FwcEluZm99IFRoZSBwYXJzZWQgYXBwbGljYXRpb24gaW5mb3JtYXRpb24uXG4gKi9cbmFwa1V0aWxzTWV0aG9kcy5nZXRBcGtJbmZvID0gYXN5bmMgZnVuY3Rpb24gZ2V0QXBrSW5mbyAoYXBwUGF0aCkge1xuICBpZiAoIWF3YWl0IGZzLmV4aXN0cyhhcHBQYXRoKSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgVGhlIGZpbGUgYXQgcGF0aCAke2FwcFBhdGh9IGRvZXMgbm90IGV4aXN0IG9yIGlzIG5vdCBhY2Nlc3NpYmxlYCk7XG4gIH1cblxuICBpZiAoYXBwUGF0aC5lbmRzV2l0aChBUEtTX0VYVEVOU0lPTikpIHtcbiAgICBhcHBQYXRoID0gYXdhaXQgdGhpcy5leHRyYWN0QmFzZUFwayhhcHBQYXRoKTtcbiAgfVxuXG4gIHRyeSB7XG4gICAgY29uc3QgYXBrYW5hbHl6ZXJQYXRoID0gYXdhaXQgZ2V0QXBrYW5hbHl6ZXJGb3JPcyh0aGlzKTtcbiAgICBjb25zdCBhcmdzID0gWydtYW5pZmVzdCcsICdwcmludCcsIGFwcFBhdGhdO1xuICAgIGxvZy5kZWJ1ZyhgU3RhcnRpbmcgJyR7YXBrYW5hbHl6ZXJQYXRofScgd2l0aCBhcmdzICR7SlNPTi5zdHJpbmdpZnkoYXJncyl9YCk7XG4gICAgY29uc3Qge3N0ZG91dH0gPSBhd2FpdCBleGVjKGFwa2FuYWx5emVyUGF0aCwgYXJncywge1xuICAgICAgc2hlbGw6IHRydWUsXG4gICAgICBjd2Q6IHBhdGguZGlybmFtZShhcGthbmFseXplclBhdGgpLFxuICAgIH0pO1xuICAgIGNvbnN0IHtwa2csIHZlcnNpb25OYW1lLCB2ZXJzaW9uQ29kZX0gPSBwYXJzZU1hbmlmZXN0KHN0ZG91dCk7XG4gICAgcmV0dXJuIHtcbiAgICAgIG5hbWU6IHBrZyxcbiAgICAgIHZlcnNpb25Db2RlLFxuICAgICAgdmVyc2lvbk5hbWUsXG4gICAgfTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIGxvZy5pbmZvKGBDYW5ub3QgZXh0cmFjdCBhcGsgaW5mbyB1c2luZyBhcGthbmFseXplci4gRmFsbGluZyBiYWNrIHRvIGFhcHQuIGAgK1xuICAgICAgYE9yaWdpbmFsIGVycm9yOiAke2Uuc3RkZXJyIHx8IGUubWVzc2FnZX1gKTtcbiAgICBhd2FpdCB0aGlzLmluaXRBYXB0KCk7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHtzdGRvdXR9ID0gYXdhaXQgZXhlYyh0aGlzLmJpbmFyaWVzLmFhcHQsIFsnZCcsICdiYWRnaW5nJywgYXBwUGF0aF0pO1xuICAgICAgY29uc3QgbWF0Y2hlcyA9IG5ldyBSZWdFeHAoL3BhY2thZ2U6IG5hbWU9JyhbXiddKyknIHZlcnNpb25Db2RlPScoXFxkKyknIHZlcnNpb25OYW1lPScoW14nXSspJy8pLmV4ZWMoc3Rkb3V0KTtcbiAgICAgIGlmIChtYXRjaGVzKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgbmFtZTogbWF0Y2hlc1sxXSxcbiAgICAgICAgICB2ZXJzaW9uQ29kZTogcGFyc2VJbnQobWF0Y2hlc1syXSwgMTApLFxuICAgICAgICAgIHZlcnNpb25OYW1lOiBtYXRjaGVzWzNdXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBsb2cud2FybihgRXJyb3IgXCIke2Vyci5zdGRlcnIgfHwgZXJyLm1lc3NhZ2V9XCIgd2hpbGUgZ2V0dGluZyBiYWRnaW5nIGluZm9gKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHt9O1xufTtcblxuLyoqXG4gKiBHZXQgdGhlIHBhY2thZ2UgaW5mbyBmcm9tIHRoZSBpbnN0YWxsZWQgYXBwbGljYXRpb24uXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHBrZyAtIFRoZSBuYW1lIG9mIHRoZSBpbnN0YWxsZWQgcGFja2FnZS5cbiAqIEByZXR1cm4gez9BcHBJbmZvfSBUaGUgcGFyc2VkIGFwcGxpY2F0aW9uIGluZm9ybWF0aW9uLlxuICovXG5hcGtVdGlsc01ldGhvZHMuZ2V0UGFja2FnZUluZm8gPSBhc3luYyBmdW5jdGlvbiBnZXRQYWNrYWdlSW5mbyAocGtnKSB7XG4gIGxvZy5kZWJ1ZyhgR2V0dGluZyBwYWNrYWdlIGluZm8gZm9yICcke3BrZ30nYCk7XG4gIGxldCByZXN1bHQgPSB7bmFtZTogcGtnfTtcbiAgdHJ5IHtcbiAgICBjb25zdCBzdGRvdXQgPSBhd2FpdCB0aGlzLnNoZWxsKFsnZHVtcHN5cycsICdwYWNrYWdlJywgcGtnXSk7XG4gICAgY29uc3QgdmVyc2lvbk5hbWVNYXRjaCA9IG5ldyBSZWdFeHAoL3ZlcnNpb25OYW1lPShbXFxkKy5dKykvKS5leGVjKHN0ZG91dCk7XG4gICAgaWYgKHZlcnNpb25OYW1lTWF0Y2gpIHtcbiAgICAgIHJlc3VsdC52ZXJzaW9uTmFtZSA9IHZlcnNpb25OYW1lTWF0Y2hbMV07XG4gICAgfVxuICAgIGNvbnN0IHZlcnNpb25Db2RlTWF0Y2ggPSBuZXcgUmVnRXhwKC92ZXJzaW9uQ29kZT0oXFxkKykvKS5leGVjKHN0ZG91dCk7XG4gICAgaWYgKHZlcnNpb25Db2RlTWF0Y2gpIHtcbiAgICAgIHJlc3VsdC52ZXJzaW9uQ29kZSA9IHBhcnNlSW50KHZlcnNpb25Db2RlTWF0Y2hbMV0sIDEwKTtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgbG9nLndhcm4oYEVycm9yICcke2Vyci5tZXNzYWdlfScgd2hpbGUgZHVtcGluZyBwYWNrYWdlIGluZm9gKTtcbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufTtcblxuYXBrVXRpbHNNZXRob2RzLnB1bGxBcGsgPSBhc3luYyBmdW5jdGlvbiBwdWxsQXBrIChwa2csIHRtcERpcikge1xuICBjb25zdCBwa2dQYXRoID0gKGF3YWl0IHRoaXMuYWRiRXhlYyhbJ3NoZWxsJywgJ3BtJywgJ3BhdGgnLCBwa2ddKSkucmVwbGFjZSgncGFja2FnZTonLCAnJyk7XG4gIGNvbnN0IHRtcEFwcCA9IHBhdGgucmVzb2x2ZSh0bXBEaXIsIGAke3BrZ30uYXBrYCk7XG4gIGF3YWl0IHRoaXMucHVsbChwa2dQYXRoLCB0bXBBcHApO1xuICBsb2cuZGVidWcoYFB1bGxlZCBhcHAgZm9yIHBhY2thZ2UgJyR7cGtnfScgdG8gJyR7dG1wQXBwfSdgKTtcbiAgcmV0dXJuIHRtcEFwcDtcbn07XG5cbmV4cG9ydCB7IFJFTU9URV9DQUNIRV9ST09UIH07XG5leHBvcnQgZGVmYXVsdCBhcGtVdGlsc01ldGhvZHM7XG4iXSwiZmlsZSI6ImxpYi90b29scy9hcGstdXRpbHMuanMiLCJzb3VyY2VSb290IjoiLi4vLi4vLi4ifQ==
